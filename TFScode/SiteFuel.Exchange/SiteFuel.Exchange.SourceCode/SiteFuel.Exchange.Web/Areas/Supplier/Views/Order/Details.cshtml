@model OrderDetailsViewModel
@using System.ComponentModel.DataAnnotations
@using System.Threading
@using System.Text;
@{
    ViewBag.Title = "Order Details";
    Thread.CurrentThread.CurrentUICulture = new System.Globalization.CultureInfo(Model.Culture);
}
<script src="~/Content/js/common-supplier.js"></script>
@Html.HiddenFor(m => m.FuelDetails.IsMarineLocation)
@Html.HiddenFor(m => m.IsSupressOrderPricing)
<body>
    <div class="row">
        <div class="col-sm-12">

            <div class="row">

                <div class="col-sm-12 dib">
                    @if (Model.IsMultiOrder)
                    {
                        <div style="cursor: pointer">
                            <span><label class="alert alert-warning pt5 pb5 fs12 mb10" id="lblActionRequired"><span class="f-bold">Action Required: </span>@string.Format("{0} {1} from {2} canceled Order #{3}", Model.BuyerUserFirstName, Model.BuyerUserLastName, Model.BuyerCompanyName, Model.PoNumber). <a data-toggle="modal" data-target="#modal-multi-orders" href="javascript:void(0)">Click here</a> to take action.</label></span>
                        </div>
                    }
                </div>
                <div class="col-sm-10 mb10 tab-headers dib">
                    <a id="tab-details" href="javascript:void(0)" onclick="showsection('order-details'), activelink(this), inputBoxShowHide(null, 'download')" class="active mr15">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">@Resource.tabheadingDetails</span>
                        </div>
                    </a>
                    <a id="tab-po" href="javascript:void(0)" onclick="showsection('order-po'), activelink(this), inputBoxShowHide('download', null)" class="mr15">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">
                                @Resource.tabHeadingPO
                            </span>
                        </div>
                    </a>
                    <a id="tab-invoices-grid" onclick="showsection('invoices-grid'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 single-ajax-mode"
                       data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#invoices-grid" data-ajax-complete="completed"
                       data-ajax-url="@Url.Action("OrderInvoicesGrid", "OrderBase", new { area = "", orderId = Model.Id, poNumber = Model.PoNumber })">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">
                                @Resource.headingInvoices
                            </span>
                        </div>
                    </a>
                    <a id="tab-ddt-grid" onclick="showsection('ddt-grid'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 single-ajax-mode"
                       data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#ddt-grid"
                       data-ajax-url="@Url.Action("OrderDropTicketsGrid", "OrderBase", new { area = "", orderId = Model.Id })">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">
                                @Resource.headingDropTickets
                            </span>
                        </div>
                    </a>
                    <a id="tab-completed-deliveries-grid" onclick="showsection('completed-deliveries-grid'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 single-ajax-mode"
                       data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#completed-deliveries-grid"
                       data-ajax-url="@Url.Action("OrderCompletedDeliveryGrid", "OrderBase", new { area = "", orderId = Model.Id })">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">
                                @Resource.headingDeliveries
                            </span>
                        </div>
                    </a>
                    @if (Model.FuelDeliveryDetails.DeliveryTypeId == (int)DeliveryType.MultipleDeliveries)
                    {
                        <a id="tab-schedules" href="javascript:void(0)" onclick="showsection('order-deliveryschedules'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 schedule-tab">
                            <div class="step-inprogress fs16">
                                <span class="f-light step-text float-left">@Resource.tabHeadingSchedules</span>
                            </div>
                        </a>
                        if (Model.IsProFormaPo
                            &&
                               (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest
                                ||
                                (Model.FuelRequestTypeId == (int)FuelRequestType.BrokeredFuelRequest && Model.BuyerCompanyId == CurrentUser.CompanyId)
                               )
                           )
                        {
                            <a id="tab-dropinformation" onclick="showsection('tab-contents-dropinformation'), activelink(this), inputBoxShowHide('btnSubmit', 'download')" class="mr15 schedule-tab"
                               data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#tab-contents-dropinformation"
                               data-ajax-url="@Url.Action("DropInformationTab", "Order", new { area = "Supplier", id = Model.Id })">
                                <div class="step-inprogress fs16">
                                    <span class="f-light step-text float-left">@Resource.tabHeadingDropInformation</span>
                                </div>
                            </a>
                        }
                    }
                    @if (!Model.FuelDetails.IsMarineLocation)
                    {
                        if (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest)
                        {
                            <a id="tab-assets" href="javascript:void(0)" onclick="showsection('order-supplier-assets'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 order-asset-tab">
                                <div class="step-inprogress fs16">
                                    <span class="f-light step-text float-left">@Resource.lblAssetsTanks</span>
                                </div>
                            </a>
                        }
                        else if (Model.AssetsAssigned > 0 || Model.IsAssetHistoryAvailable)
                        {
                            <a id="tab-assets" href="javascript:void(0)" onclick="showsection('supplier-asset-grids'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 order-asset-tab">
                                <div class="step-inprogress fs16">
                                    <span class="f-light step-text float-left">@Resource.lblAssetsTanks</span>
                                </div>
                            </a>
                        }
                    }
                    @if (!Model.IsBrokeredOrder)
                    {
                        <a id="tab-brokered-fr" onclick="showsection('brokered-fr-grid'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 single-ajax-mode"
                           data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#brokered-fr-grid"
                           data-ajax-url="@Url.Action("OrderBrokeredFuelRequestsGrid", "OrderBase", new { area = "", orderId = Model.Id })">
                            <div class="step-inprogress fs16">
                                <span class="f-light step-text float-left">
                                    @Resource.lblBrokered
                                </span>
                            </div>
                        </a>
                    }
                    <a id="tab-order-history-grid" onclick="showsection('order-history-grid'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 single-ajax-mode"
                       data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#order-history-grid"
                       data-ajax-url="@Url.Action("OrderHistoryGrid", "OrderBase", new { area = "", id = Model.Id })">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">
                                @Resource.headingHistory
                            </span>
                        </div>
                    </a>
                    <a id="tab-version" onclick="showsection('tab-contents-version'), activelink(this), inputBoxShowHide(null, 'download')" class="mr15 single-ajax-mode"
                       data-ajax="true" data-ajax-loading="#ajax-loading" data-ajax-method="GET" data-ajax-mode="replace" data-ajax-update="#tab-contents-version"
                       data-ajax-url="@Url.Action("OrderVersionView", "OrderBase", new { area = "", id = Model.Id })">
                        <div class="step-inprogress fs16">
                            <span class="f-light step-text float-left">
                                @Resource.gridColumnVersion
                            </span>
                        </div>
                    </a>
                </div>
                <div class="col-sm-2 text-right mb5-xs">
                    <div class="btn-group">
                        <button id="auto-btnorderaction" data-toggle="dropdown" class="btn btn-default btn-sm dropdown-toggle" aria-expanded="false">@Resource.btnLabelAction <span class="caret"></span></button>
                        <ul class="dropdown-menu dropdown-menu-right large-menu">
                            @if (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest)
                            {
                                <li class="dropdown-item">
                                    @Html.ActionLinkIcon(Resource.lblCloneOrder, "Clone", "Order",
                    new { area = "Supplier", orderId = Model.Id },
                    new
                    {
                        id = "btn-clone"
                    }, "fa far fa-copy pull-left mt5 mr5")
                                </li>
                                <li role="separator" class="divider"></li>
                            }
                            @if (Model.StatusId == (int)OrderStatus.Open)
                            {
                                if (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier)
                                {
                                    if (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest)
                                    {
                                        <li class="dropdown-item"><a href="@Url.Action("Edit", "Order", new { area = "Supplier", Id = Model.Id })">@Resource.btnLabelEdit <i class="fa fas fa-edit float-left mt7 mr5"></i></a></li>
                                        <li role="separator" class="divider"></li>
                                    }
                                    <li class="dropdown-item">
                                        @Html.ActionLinkIcon(Resource.btnLabelCancelOrder, "Cancel", "Order",
                        new { area = "Supplier", id = Model.Id },
                        new
                        {
                            id = "btn-cancel",
                            data_toggle = "confirmation",
                            data_popout = "true",
                            data_singleton = "true",
                            data_placement = "bottom"
                        }, "fa fa-times color-maroon float-left mt7 mr5")
                                    </li>
                                    <li role="separator" class="divider"></li>
                                    <li class="dropdown-item">
                                        @Html.ActionLinkIcon(Resource.btnLabelClose, "Close", "Order",
                        new { area = "Supplier", id = Model.Id },
                        new
                        {
                            id = "btn-close",
                            data_toggle = "confirmation",
                            data_popout = "true",
                            data_singleton = "true",
                            data_placement = "bottom"
                        }, "fa fa-check color-green float-left mt7 mr5")
                                    </li>
                                    <li role="separator" class="divider"></li>
                                    if (!CurrentUser.IsAccountingPerson)
                                    {
                                        if (!Model.IsBrokeredOrder)
                                        {
                                            <li class="dropdown-item">
                                                @Html.ActionLinkIcon(Resource.btnLabelDryRun, "DryRun", "Invoice",
                                new { area = "Supplier", id = Model.Id },
                                new
                                {
                                    id = "btn-dryrun",
                                    data_toggle = "confirmation",
                                    data_popout = "true",
                                    data_singleton = "true",
                                    data_placement = "bottom"
                                }, "fa fa-truck float-left mt5 mr5")
                                            </li>
                                            <li role="separator" class="divider"></li>
                                        }
                                        if (Model.StatusId == (int)OrderStatus.Open && !Model.IsBrokeredOrder && Model.IsBrokerVisible && !Model.IsSupressOrderPricing)
                                        {
                                            <li class="dropdown-item">
                                                @Html.ActionLinkIcon(Resource.btnLabelBroker, "Create", "Broker",
                                new { area = "Supplier", id = Model.FuelRequestId },
                                new
                                {
                                    id = "btn-broker",
                                }, "fa fa-link float-left mt7 mr5")
                                            </li>
                                            <li role="separator" class="divider"></li>
                                        }
                                    }
                                }
                            }
                            @if ((Model.StatusId == (int)OrderStatus.Open || Model.IsSingleDeliveryClosedOrderWithZeroPercent) && !Model.IsBrokeredOrder && (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier || CurrentUser.IsAccountingPerson))
                            {
                                if (Model.IsSupressOrderPricing)
                                {
                                    if (Model.IsSupressOrderPricing)
                                    {
                                        <li class="dropdown-item">
                                            <a href="javascript:void(0)" id="btnCreateDDTNew" class="@(Model.IsDefaultInvoiceTypeManual ? "hide-element" : "")" onclick="location.href='@Url.Action("CreateNew", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.btnLabelCreateDDT<i class="fa fa-money float-left mt7 mr5"></i></a>
                                        </li>
                                        <li role="separator" class="divider"></li>
                                    }
                                    @*if (Model.FuelDetails.IsMarineLocation)
                {
                    <li class="dropdown-item">
                        <a href="javascript:void(0)" id="btnCreateDDTNew" onclick="location.href='@Url.Action("CreateNew", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.btnLabelCreateDDT<i class="fa fa-money float-left mt7 mr5"></i></a>
                    </li>
                    <li role="separator" class="divider"></li>
                }*@

                                }
                                else
                                {
                                    <li class="dropdown-item">
                                        <a href="javascript:void(0)" id="btnCreateInvoiceNew" class="@(Model.IsDefaultInvoiceTypeManual ? "" : "hide-element")" onclick="location.href='@Url.Action("CreateNew", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.btnLabelCreateInvoice<i class="fa fas fa-dollar float-left mt7 mr5"></i></a>
                                        <a href="javascript:void(0)" id="btnCreateDDTNew" class="@(Model.IsDefaultInvoiceTypeManual ? "hide-element" : "")" onclick="location.href='@Url.Action("CreateNew", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.btnLabelCreateDDT<i class="fa fa-money float-left mt7 mr5"></i></a>
                                    </li>

                                    <li role="separator" class="divider"></li>
                                    <li class="dropdown-item">
                                        <a href="javascript:void(0)" id="btnCreateBalanceInvoice" onclick="location.href='@Url.Action("Balance", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.btnLabelCreateBalanceInvoice <i class="fa fa-plus float-left mt7 mr5"></i></a>
                                    </li>
                                    <li role="separator" class="divider"></li>
                                    <li class="dropdown-item tank-invoice-link  @(Model.FuelDetails.TankFrequencies.Any(t => t.ActivationStatusId == (int)ActivationStatus.Active) ? "" : "hide-element")">
                                        <a href="javascript:void(0)" id="btnCreateTankRentalInvoice" onclick="location.href='@Url.Action("TankRental", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.btnLabelCreateTankRentalInvoice <i class="fa fa-tint float-left mt7 mr5"></i></a>
                                    </li>
                                    <li role="separator" class="tank-invoice-link @(Model.FuelDetails.TankFrequencies.Any(t => t.ActivationStatusId == (int)ActivationStatus.Active) ? "" : "hide-element") divider"></li>
                                    if (Model.IsFTLEnabled)
                                    {
                                        <li class="dropdown-item">
                                            <a href="javascript:void(0)" id="btnCreateSplitInvoice" class="@(Model.IsDefaultInvoiceTypeManual ? "" : "hide-element")" onclick="location.href='@Url.Action("CreateSplitInvoice", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.lblCreateSplitInvoice <i class="fa fas fa-network-wired float-left mt5 mr5"></i></a>
                                            <a href="javascript:void(0)" id="btnCreateSplitDropTicket" class="@(Model.IsDefaultInvoiceTypeManual ? "hide-element" : "")" onclick="location.href='@Url.Action("CreateSplitInvoice", "Invoice", new { area = "Supplier", orderId = Model.Id })'">@Resource.lblCreateSplitLoadDropTicket <i class="fa fas fa-network-wired float-left mt5 mr5"></i></a>
                                        </li>
                                        <li role="separator" class="divider"></li>
                                    }
                                }
                            }
                            <li class="dropdown-item"><a href="javascript:void(0)" id="btnCreateInvoice" class="btn-download" onclick="location.href='@Url.Action("DownloadPdf", "OrderBase", new { area = "", id = Model.Id })'">@Resource.lblDownloadPO <i class="fa fas fa-download float-left mt5 mr5"></i></a></li>
                            <li role="separator" class="divider"></li>
                            @{ var emailUrl = Url.Action("EmailDocumentPopup", "Order", new { area = "Supplier" }); }
                            <li class="dropdown-item"><a href="javascript:void(0)" id="btnEmailPo" onclick="return showEmailDocPopup('@Model.Id', '@Model.PoNumber', null, '@((int)CompanyType.Supplier)', '@((int)DocumentName.PO)', '@emailUrl');">@Resource.lblEmailPO <i class="fa fas fa-envelope float-left mt5 mr5"></i></a></li>
                            @if (Model.FuelDetails.IsMarineLocation)
                            {
                                <li role="separator" class="divider"></li>
                                <li class="dropdown-item"><a href="javascript:void(0)" id="btnDownloadProforma" class="btn-download" onclick="location.href='@Url.Action("DownloadProformaBDNPdf", "Invoice", new { area = "Supplier", id = Model.Id })'">Download Proforma BDN <i class="fa fas fa-download float-left mt5 mr5"></i></a></li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
            <div class="panel-section hide-element bg-white radius-5 animated slideInLeft pa">
                <a href="javascript:void(0)" class="pa fs25 right0 top0 color-darkgrey mr15 mt5 z-index5" onclick="closePanel()">×</a>
                <div class="pt15 pb15 ph20">
                    <div class="row">
                        <div class="col-6 col-sm-12 col-md-6 mb10">
                            <div class="no-margins fs18 float-left gallonsordered" id="auto-lblgallons"></div>
                            <span class="float-left fs11 pt8 pl2 uom"></span>
                            <span class="fs12 float-left clearboth">@Resource.lblOrdered</span>
                        </div>
                        <div class="col-6 col-sm-12 col-md-6 mb10">
                            <div class="no-margins fs18 float-left" id="auto-lbldelivered"></div>
                            <span class="float-left fs11 pt8 pl2 uom"></span>
                            <span class="fs12 float-left clearboth">@Resource.lblDelivered</span>
                        </div>
                        <div class="col-6 col-sm-12 col-md-6 mb10">
                            <span class="float-left mt3">@Resource.constSymbolCurrency</span>
                            <div class="no-margins fs18 float-left" id="auto-lblppg"></div>
                            <span class="currency-symbol float-left fs11 pt8 pl2 currency"></span>
                            <span class="fs12 clearboth float-left avg-ppg">@(string.Format(Resource.lblAvgPricePerDrop, "PPU"))</span>
                        </div>
                        <div class="col-6 col-sm-12 col-md-6 mb10">
                            <div class="no-margins fs18 float-left" id="auto-avgdelivery"></div>
                            <span class="float-left fs11 pt8 pl2 uom"></span>
                            <span class="fs12 float-left clearboth">@Resource.lblAvgGallonsDrop</span>
                        </div>
                    </div>
                </div>
                <div class="border-b-dash ml20 mr20 clearboth"></div>
                <div class="pt15 pb25 ph20">
                    <h4 class="f-light fs18 no-margins pt0">@Resource.lblNextScheduledDelivery</h4>
                    <div class="row">
                        <div class="text-center col-sm-12" id="auto-txtnextdeliveryschedule">
                            <h3 class="l-height22 f-normal fs16 mt10 mb0">@Resource.lblHyphen</h3>
                        </div>
                    </div>
                </div>
                <div class="border-b-dash ml20 mr20 clearboth"></div>
                <div class="pt15 pb25 ph20">
                    @Html.Partial("_PartialNewsfeeds")
                </div>
            </div>
            <div class="tab-container pr">
                <div class="mb10 panel-icon">
                    <a href="javascript:void(0)" id="auto-lblOrderInfo" class="radius-5 dib text-center" onclick="loadSidePanel();">
                        @Resource.lblOrderInfo
                    </a>
                </div>
                <div id="order-details">
                    <!-- order details starts -->
                    <div class="col-sm-12">
                        <div class="row well mb15">
                            <div class="col-sm-12 pb15">
                                <h4 class="dib">@Resource.headingOrder</h4>
                                <div class="dib pull-right pt5">
                                    <div id="auto-lblstatus" class="dib mt3">
                                        @if (Model.StatusId == (int)OrderStatus.Open)
                                        {
                                            <label class="label label-warning">@(CommonHelperMethods.GetName<OrderStatus>(Model.StatusId))</label>
                                        }
                                        else if (Model.IsMultiOrder)
                                        {
                                            <label class="label label-danger" id="lblActionRequired">Action Required</label>
                                        }
                                        else if (Model.StatusId == (int)OrderStatus.Closed)
                                        {
                                            <label class="label label-danger">@(CommonHelperMethods.GetName<OrderStatus>(Model.StatusId))</label>
                                        }
                                        else if (Model.StatusId == (int)OrderStatus.Canceled)
                                        {
                                            <label class="label label-danger">@(CommonHelperMethods.GetName<OrderStatus>(Model.StatusId))</label>
                                        }
                                    </div>
                                    @if (!Model.IsProFormaPo && Model.FuelDetails.FuelQuantity.QuantityTypeId != (int)QuantityType.NotSpecified)
                                    {
                                        <span>@Model.FuelDeliveredPercentage @Resource.lblCompleted</span>
                                    }
                                </div>
                                <div class="row">
                                    @if (!string.IsNullOrEmpty(Model.ScheduleName))
                                    {
                                        <div class="col-sm-12">
                                            <div class="alert alert-warning mb10 pt5 pb5">
                                                @Resource.warningMessageOrderSchedule <a href="@Url.Action("Create", "BillingSchedule", new { area = "Supplier", id = Model.ScheduleId })">@Html.DisplayFor(m => m.ScheduleName)</a>
                                            </div>
                                        </div>
                                    }
                                    <div class="orderName-details col-sm-2">
                                        <div class='pa text-center bg-white wbs-loader loading-wrapper hide-element'>
                                            <span class='spinner-small pa col-1'></span>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label class="f-normal">@Resource.lblOrderName</label>
                                                <a id="edit-orderName-icon" href="javascript:void(0)" class="ftl-controls" onclick="editOrderName(this, 'orderName-details', 'orderName-buttons');focusOnFirst(this,'orderName-text');"><i class="fa fa-edit"></i></a>
                                                <div class="ftl-controls orderName-text disable-controls">
                                                    <div class="form-group mb0">
                                                        <input type="hidden" value="@Model.OrderName" id="hdnOrderName" />
                                                        @Html.TextBoxFor(m => m.OrderName, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.OrderName)
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-12 text-right orderName-buttons  hide-element mt10">
                                                <input id="cancelOrderName" type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions"
                                                       onclick="cancelEditOrderName('edit-orderName-icon','orderName-details','orderName-buttons')" />
                                                <button class="btn btn-sm btn-primary" onclick="updateOrderName()">
                                                    @Resource.btnLabelSave
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 col-6 mb10">
                                        <label class="f-normal">@Resource.lblPoNumber</label>
                                        @if (Model.AllowPoEdit)
                                        {
                                            <a href="javascript:void(0)" onclick="toggleEditWindow('po-edit')"><span class="fa fa-edit"></span></a>
                                        }
                                        <div>
                                            <span id="lblPoNumber" class="break-word">@Model.PoNumber</span>&nbsp;
                                        </div>
                                        @if (Model.FuelRequestTypeId == (int)FuelRequestType.FreightOnlyRequest)
                                        {
                                            <label class="f-normal color-orange">(@Resource.lblFreightOnlyOrder)</label>
                                        }
                                        <!-- edit po starts -->
                                        <div class="border hide-element z-index5 pa pl15 pr15 ml15 bg-white po-edit shadow-b" id="po-edit-modal">
                                            <div class="pa bg-white top0 left0 z-index5 loading-wrapper hide-element"><span class='spinner-dashboard pa'></span></div>
                                            <i class="fa fa-times pull-right mt5 mb10" aria-hidden="true" onclick="toggleEditWindow('po-edit')"></i>
                                            <div class="form-group">
                                                @Html.TextBoxFor(m => m.PoNumber, new { @class = "form-control" })
                                                @Html.ValidationMessageFor(m => m.PoNumber)
                                            </div>
                                            <div class="form-group text-right">
                                                <input type="button" value="@Resource.btnLabelCancel" id="btnCancelPoNumber" class="btn btn-sm" onclick="toggleEditWindow('po-edit')" />
                                                @*data-toggle='confirmation' data-html='true' data-popout='true' data-singleton='true' data-on-confirm="savePoNumber"
                    data-placement='top' id="btnsavePoNumber" data-title="Are you sure you want to update the PO#?"*@
                                                <button class="btn btn-primary btn-sm" type="button" data-toggle='confirmation' data-html='true' data-popout='true' data-singleton='true' data-confirmation-event="savePoNumber"
                                                        data-placement='top' id="btnsavePoNumber" data-title="Are you sure you want to update the PO#?">
                                                    @Resource.btnLabelSave
                                                </button>
                                            </div>
                                        </div>
                                        <!-- edit po ends -->
                                    </div>
                                    @if (!string.IsNullOrWhiteSpace(Model.GroupPoNumber))
                                    {
                                        <div class="col-6 col-sm-2 mb10">
                                            <label class="f-normal">@Resource.gridColumnCustomerPo</label>
                                            <div class="break-word"><a href="@Url.Action("Details","Order",new { area="Supplier" , id=Model.Id })">@Html.DisplayFor(m => m.GroupPoNumber)</a></div>
                                        </div>
                                    }
                                    <div class="col-6 col-sm-2 mb10">
                                        <label class="f-normal">@(!Model.IsBrokeredOrder ? Resource.lblCustomerContact : Resource.lblSupplierContact)</label>
                                        <div class="break-word" id="auto-lblcustomer">
                                            @Model.Supplier.Name <br />
                                            @Model.Supplier.Email <br />
                                            <span class="phone">@Model.Supplier.PhoneNumber</span>
                                        </div>
                                        @if (Model.CustomerContacts != null && Model.CustomerContacts.Any())
                                        {
                                            <a id="view-more-contacts" href="javascript:void(0)" onclick="toggleMoreContactsWindow('more-contacts');"><i class="fa fa-user"></i> More Contacts</a>
                                            <!-- edit po starts -->
                                            <div class="border hide-element z-index5 pa bg-white more-contacts shadow-b mt-2" id="customer-contact-modal">
                                                <div class="text-right pr-3">
                                                    <a href="javascript:void()" onclick="toggleMoreContactsWindow('more-contacts')"><i class="fa fa-times my-2" aria-hidden="true"></i></a>
                                                </div>
                                                <div class="pa bg-white top0 left0 z-index5 loading-wrapper hide-element"><span class='spinner-dashboard pa'></span></div>
                                                <div class="col-sm-12" id="modal-customer-contact">
                                                    @foreach (var contact in Model.CustomerContacts)
                                                    {
                                                        <div class="break-word mb-3">
                                                            @contact.Name <br />
                                                            @contact.Email <br />
                                                            <span class="phone">@contact.PhoneNumber</span>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                            <!-- edit po ends -->
                                        }
                                    </div>
                                    <div class="col-6 col-sm-2 mb10">
                                        <label class="f-normal">@(!Model.IsBrokeredOrder ? @Resource.lblCustomerCompany : @Resource.lblSupplierCompany) </label>
                                        <div class="break-word" id="lblCustomerCompany">
                                            @Model.BuyerCompanyName
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-2 mb10">
                                        <label class="f-normal"> @Resource.lblAccountingCompanyId</label>
                                        @if ((Model.AccountingCompanyId != null) && (Model.AccountingCompanyId != string.Empty))
                                        {
                                            <div class="break-word">
                                                @Model.AccountingCompanyId
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="break-word">
                                                @Resource.lblHyphen
                                            </div>
                                        }
                                    </div>
                                    @if (Model.CreditCheckTypeId.HasValue && Model.CreditCheckTypeId.Value == (int)CreditCheckTypes.SAP)
                                    {
                                        <div class="col-6 col-sm-2 mb10">
                                            <label class="f-normal">@Resource.lblTFXCustomerId </label>
                                            <div class="break-word" id="lblTFXCompanyId">
                                               @CommonHelperMethods.GetCustomerTFCUId(Model.BuyerCompanyId)
                                            </div>
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.CarrierCompanyName))
                                    {
                                        <div class="col-6 col-sm-2 mb10">
                                            <label class="f-normal"> @Resource.lblCarrierCompanyName</label>
                                            <div class="break-word">
                                                @Model.CarrierCompanyName
                                            </div>
                                        </div>
                                    }
                                    @if (Model.OrderClosingThreshold != null)
                                    {
                                        <div class="col-3 col-sm-2 mb10">
                                            <label class="f-normal">@Resource.lblAutomaticallyCloseOrder</label>
                                            <div id="lblSupplierCompany">@Model.OrderClosingThreshold@Resource.constSymbolPercent @Resource.lblCompleted</div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <div class="col-sm-12 pb15" id="Fuel_Info">
                                <h4>@Resource.headingFuel</h4>
                                <div class="row">
                                    <div class="col-sm-2 col-12 mb10">
                                        @Html.HiddenFor(m => m.FuelTypeId)
                                        <label class="f-normal">@Resource.lblFuelType</label>
                                        <div class="break-word">@Model.FuelType</div> <br />
                                        @if (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier)
                                        {
                                            <label class="f-normal mt-2">@Resource.lblAssignedProductName</label>
                                            <div id="assignedProductName" class="break-word">@(!string.IsNullOrWhiteSpace(Model.OrderAdditionalDetails.SupplierAssignedProductName) ? Model.OrderAdditionalDetails.SupplierAssignedProductName : Resource.lblHyphen)</div>
                                        }
                                    </div>

                                    <div class="wbs-details col-sm-2">
                                        <div class='pa text-center bg-white wbs-loader loading-wrapper hide-element'>
                                            <span class='spinner-small pa col-1'></span>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label class="f-normal">@Resource.lblWBSNumber</label>
                                                @if (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest ||
                                                    (Model.FuelRequestTypeId == (int)FuelRequestType.BrokeredFuelRequest && Model.BuyerCompanyId == CurrentUser.CompanyId))
                                                {
                                                    <a id="edit-wbs-icon" href="javascript:void(0)" class="ftl-controls" onclick="editOrderAddditionalDetails(this, 'wbs-details', 'wbs-buttons');focusOnFirst(this,'wbs-text');"><i class="fa fa-edit"></i></a>
                                                }
                                                <div class="ftl-controls wbs-text disable-controls">
                                                    <div class="form-group mb0">
                                                        @Html.TextBoxFor(m => m.FuelDeliveryDetails.CustomAttributeViewModel.WBSNumber, new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(m => m.FuelDeliveryDetails.CustomAttributeViewModel.WBSNumber)
                                                    </div>
                                                </div>
                                                <div>
                                                    @if (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier)
                                                    {
                                                        <br />
                                                        <label class="f-normal">@Resource.lblDriverProductId</label>
                                                        <div id="driverProductId" class="break-word">@(!string.IsNullOrWhiteSpace(Model.OrderAdditionalDetails.DriverProductId) ? Model.OrderAdditionalDetails.DriverProductId : Resource.lblHyphen)</div>
                                                    }
                                                </div>
                                            </div>
                                            <div class="col-sm-12 text-right wbs-buttons hide-element mt10">
                                                <input id="cancelWBS" type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions"
                                                       onclick="cancelEditOrderAdditionalDetails('edit-wbs-icon','wbs-details','wbs-buttons'),callCancelWBS()" />
                                                <button class="btn btn-sm btn-primary" onclick="updateWbsNumber()">
                                                    @Resource.btnLabelSave
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    @if (Model.FuelDetails.IsFTLEnabled)
                                    {
                                        <div class="col-sm-2 col-6 mb10">
                                            <label class="f-normal">@Resource.lblOrderType</label>
                                            <div class="">
                                                <label>
                                                    @Resource.lblFullTruckLoad
                                                </label>
                                            </div>
                                        </div>
                                        if (Model.FuelDetails.FreightOnBoard.HasValue)
                                        {
                                            <div class="col-sm-2 col-6 mb10">
                                                <label class="f-normal">@Resource.lblFreightOnBoard</label>
                                                <div>
                                                    <label>
                                                        @(((FreightOnBoardTypes)@Model.FuelDetails.FreightOnBoard.Value).GetDisplayName())
                                                    </label>
                                                </div>
                                            </div>
                                        }
                                        if (Model.FuelDetails.FuelPricing.FuelPricingDetails.PricingQuantityIndicatorTypeId.HasValue)
                                        {
                                            <div class="col-sm-2 col-6 mb10">
                                                <label class="f-normal">@Resource.lblBillableQuantity</label>
                                                <div>
                                                    @(((QuantityIndicatorTypes)@Model.FuelDetails.FuelPricing.FuelPricingDetails.PricingQuantityIndicatorTypeId).GetDisplayName())
                                                </div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="col-md-3 col-sm-3 col-6 mb10">
                                            <label class="f-normal">@Resource.lblOrderType</label>
                                            <div class="">
                                                <label>
                                                    @Resource.lblLessTruckLoad
                                                </label>
                                            </div>
                                        </div>
                                    }
                                    @if (Model.FuelDetails.IsMarineLocation)
                                    {
                                        <div class="col-md-2 col-sm-3 col-6 mb10">
                                            <label class="f-normal">@Resource.lblVessle</label>
                                            <div class="">
                                                <label>
                                                    @{
                                                        var vessel = string.IsNullOrWhiteSpace(Model.Vessel) ? Resource.lblHyphen : Model.Vessel;
                                                        var imoNumber = string.IsNullOrWhiteSpace(Model.IMONumber) ? Resource.lblHyphen : Model.IMONumber;
                                                    }
                                                    @vessel - @imoNumber
                                                </label>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            @if (Model.SourceRegion != null)
                            {
                                <div class="section-freightPricingMethod">
                                    <div class="col-sm-12">
                                        <label class="mb-1">@Resource.lblFreightPricingMethod</label>
                                    </div>
                                    <div>
                                        <div class="form-check form-check-inline mb-3 ml-3">
                                            @Html.RadioButtonFor(m => m.SourceRegion.FreightPricingMethod, FreightPricingMethod.Manual, new { @class = "form-check-input radio-ManualFreightMethod", @checked = "checked", onchange = "freightPricingMethodChanged(1)" })
                                            <label class="form-check-label">@FreightPricingMethod.Manual.GetDisplayName()</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            @Html.RadioButtonFor(m => m.SourceRegion.FreightPricingMethod, FreightPricingMethod.Auto, new { @class = "form-check-input", onchange = "freightPricingMethodChanged(2)" })
                                            <label class="form-check-label">@FreightPricingMethod.Auto.GetDisplayName()</label>
                                        </div>
                                    </div>
                                </div>

                            }

                            @if (Model.SourceRegion != null)
                            {
                                <div class="col-sm-12 section-approved-terminals-sourceregion mt-1" id="Pickup_Info">
                                    <div class="row">
                                        @if (Model.TypeOfFuel != (int)ProductDisplayGroups.OtherFuelType && Model.TypeOfFuel != (int)ProductDisplayGroups.AdditiveFuelType)
                                        {
                                            <div class="col-sm-2 col-6 mb10">
                                                @if ((CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier || CurrentUser.IsAccountingPerson
                                                    || ((CurrentUser.IsCarrierAdmin || CurrentUser.IsCarrier || CurrentUser.IsDispatcher) && CurrentUser.IsSupplierAndCarrierCompany))
                                                    && Model.StatusId == (int)OrderStatus.Open && !Model.IsBrokeredOrder && Model.CanSupplierChangeTerminal)
                                                {
                                                    <div>
                                                        <label class="f-normal">@Resource.lblTerminal</label>
                                                        <!-- Check added as we dont have source region for existing orders-->
                                                        <a onclick="showAutoCompleteForTerminal()" title="Change Terminal"><span class="fa fa-edit"></span></a>

                                                        <div class="pr row">
                                                            <div class="pa bg-white top0 left0 z-index5 loading-wrapper terminal-loader mtm10 hide"><span class='spinner-dashboard pa'></span></div>
                                                            <div class="col-md-12">
                                                                <div class="break-word" id="auto-lblsuppterminalLbl">
                                                                    @Model.TerminalName
                                                                </div>
                                                                @Html.TextBoxFor(m => m.TerminalName, new { @class = "form-control hide" })
                                                            </div>
                                                        </div>

                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="col-sm-12">
                                                        <label class="f-normal">@Resource.lblTerminal</label>
                                                        <div class="break-word" id="auto-lblsuppterminal">
                                                            @Model.TerminalName
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="col-sm-2 col-6 mb10">
                                                <label class="f-normal">@Resource.lblProductDescription</label>
                                                <div class="break-word">@(!string.IsNullOrWhiteSpace(Model.ProductDescription) ? Model.ProductDescription : Resource.lblHyphen)</div>
                                            </div>
                                        }

                                        <div class="col-md-2 col-sm-3 col-6 mb10">
                                            <label class="f-normal">@Resource.headingPickUpLocation</label>

                                            <a id='btnChangedefault-PickUp' onclick='loadPickUpLocation(@Model.Id)' data-toggle='modal' data-target='#add-pickupLocation-modal'><span class="fas fa-edit ml5" data-toggle="tooltip" data-placement="top" title="@Resource.btnLabelEdit"></span></a>

                                            <div id="div-pick-up-location">
                                                @if (Model.FuelDetails.PickUpLocation != null)
                                                {
                                                    <div>
                                                        @Model.FuelDetails.PickUpLocation.Address.SiteName
                                                    </div>
                                                    <div class="fs12">
                                                        <i class="fas fa-map-marker fs12 mr5"></i>
                                                        @Model.FuelDetails.PickUpLocation.Address.Address,
                                                        @Model.FuelDetails.PickUpLocation.Address.City, @Model.FuelDetails.PickUpLocation.Address.State.Code @Model.FuelDetails.PickUpLocation.Address.ZipCode
                                                        @*data-toggle='confirmation' data-html='true' data-popout='true' data-singleton='true' data-on-confirm="RemovePickUpLocation" data-placement='bottom'*@
                                                        <a data-toggle='confirmation' data-html='true' data-popout='true' data-singleton='true' data-confirmation-event="RemovePickUpLocation" data-placement='bottom'><i class="fas fa-trash color-maroon fs12 ml5" data-toggle="tooltip" data-placement="top" title="@Resource.btnLabelRemove"></i></a>

                                                    </div>
                                                }
                                                else
                                                {
                                                    @Resource.lblHyphen
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            <!-- Source Region starts  -->
                            @if (Model.SourceRegion != null)
                            {
                                <div class="col-sm-12 pb15 section-source-region-and-terminals">
                                    <div class="overflow-h">
                                        <label class="float-left">@Resource.headingSourceRegionsAndTerminals <a id="edit-source-region-details" href="javascript:void(0)" class="ml5" onclick="editSourceRegion(this, 'source-region-details', 'source-region-actionbuttons'); focusOnFirst(this,'source-region-details')"><i class="fa fa-edit"></i></a> </label>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-8">
                                            <div class="row source-region-details">
                                                <div class='pa text-center bg-white order-additional-loader loading-wrapper hide-element'>
                                                    <span class='spinner-small pa col-1'></span>
                                                </div>
                                                <div id="source-region-section" class="col-sm-12 mb10 disable-controls">
                                                    @Html.PartialFor("~/Views/Shared/_PartialSourceRegion.cshtml", m => m.SourceRegion)
                                                    <span id="showMsgInformation" class="fs12"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-8 text-right source-region-actionbuttons hide-element">
                                            <input type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions" onclick="cancelEditSourceRegion('edit-source-region-details', 'source-region-details', 'source-region-actionbuttons')" />
                                            <button class="btn btn-primary btn-sm" onclick="updateSourceRegion(this)">
                                                @Resource.btnLabelSave
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            }

                            <div class="border-b-dash ma15 clearboth"></div>
                            <div class="col-sm-12">
                                <h4>@Resource.headingInvoicesDropTicket</h4>

                                <div class="row">
                                    @if ((Model.StatusId == (int)OrderStatus.Open || Model.IsSingleDeliveryClosedOrderWithZeroPercent) && !Model.IsBrokeredOrder)
                                    {
                                        <div class="col-6 col-sm-2 @(CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier || CurrentUser.IsAccountingPerson ? "" : "pntr-none")">
                                            <label class="f-normal db">@Resource.lblType</label>
                                            <div id="inv-btn" class="form-check mb5 @(Model.IsSupressOrderPricing ? "hide-element" : "")">
                                                @*|| Model.FuelDetails.IsMarineLocation*@
                                                @Html.RadioButtonFor(m => m.IsDefaultInvoiceTypeManual, true, new { @id = "radio-invoice", @class = "form-check-input", onclick = "radioChange(this, null,'invoice-type')", onchange = "SetDefaultInvoiceType(this, 'invoice-type')" })
                                                <label class="form-check-label" for="radio-invoice">
                                                    @Resource.lblInvoice
                                                </label>
                                            </div>
                                            <div id="ddt-btn" class="form-check">
                                                @Html.RadioButtonFor(m => m.IsDefaultInvoiceTypeManual, false, new { @id = "radio-ddt", @class = "form-check-input", onclick = "radioChange(this,'invoice-type',null);", onchange = "SetDefaultInvoiceType(this, 'invoice-type')" })
                                                <label class="form-check-label" for="radio-ddt">
                                                    @Resource.lblDDT
                                                </label>
                                            </div>
                                        </div>
                                    }
                                    <div class="col-sm-6 col-md-2 mb10 @(Model.ExternalBrokerId > 0 || Model.IsSupressOrderPricing ? "pntr-none subSectionOpacity" : "")">
                                        <label class="f-normal">@Resource.lblDDT</label>
                                        <div class="form-check form-check-inline">
                                            @Html.CheckBoxFor(m => m.IsHidePricingEnabled, new { @class = "form-check-input", @id = "checkbox-hidepricing" })
                                            <label class="form-check-label" for="checkbox-hidepricing">@Resource.lblHidePricing</label>
                                        </div>
                                    </div>
                                    @if (!Model.FuelDetails.IsMarineLocation)
                                    {
                                        <div class="col-sm-2 col-6">
                                            <label class="f-normal">@Resource.lblInvoiceCreationPreference</label>
                                            <div>
                                                @{
                                                    OrderEnforcement OrderEnforcementName = (OrderEnforcement)Model.FuelDeliveryDetails.OrderEnforcementId;
                                                    var orderEnforcementName = OrderEnforcementName.GetDisplayName();
                                                }
                                                @orderEnforcementName
                                            </div>
                                        </div>
                                    }

                                    @if (!Model.FuelDetails.IsMarineLocation)
                                    {
                                        if (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest)
                                        {
                                            <div class="col-sm-4 col-6 mb10">
                                                <div class="form-check form-check-inline">
                                                    @Html.CheckBoxFor(m => m.FuelDeliveryDetails.IsPrePostDipRequired, new { @class = "form-check-input" })
                                                    <label class="form-check-label" for="FuelDeliveryDetails_IsPrePostDipRequired">@Resource.lblRequiredPrePostDipTestDataForEachTankAsset</label>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="col-sm-4 col-6">
                                                <label class="f-normal">@Resource.lblRequiredPrePostDipTestDataForEachTankAsset</label>
                                                <div>
                                                    @{
                                                        var IsPrePostDipRequired = Model.FuelDeliveryDetails.IsPrePostDipRequired ? @Resource.lblYes : @Resource.lblNo;
                                                    }
                                                    @IsPrePostDipRequired
                                                </div>
                                            </div>
                                        }
                                    }
                                    <div>
                                        @if (Model.FuelDetails.IsMarineLocation)
                                        {
                                            <div class="form-check form-check-inline">
                                                @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsManualBDNConfirmationRequired, new { @class = "form-check-input", @disabled = "disabled" })
                                                <label class="form-check-label">@Resource.lblRequiredBDNConfirmation</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsManualInvoiceConfirmationRequired, new { @class = "form-check-input", @disabled = "disabled" })
                                                <label class="form-check-label">@Resource.lblRequiredInvoiceConfirmation</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsPdiTaxRequired, new { @class = "form-check-input", @disabled = "disabled" })
                                                <label class="form-check-label">@Resource.lblPdieTaxRequired</label>
                                            </div>
                                        }
                                    </div>
                                </div>
                                <div class="border-b-dash mt15 mb15 clearboth"></div>
                            </div>
                            @if (Model.OrderAdditionalDetails != null)
                            {
                                if (!Model.IsSupressOrderPricing)
                                {
                                    <div class="col-sm-12">
                                        <h4>@Resource.lblInvoiceNotificationInstructions</h4>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class='pa text-center bg-white delivery-instructions-loader loading-wrapper hide-element'>
                                                    <span class='spinner-small pa col-1'></span>
                                                </div>
                                                <div class="row">
                                                    @foreach (var pref in Enum.GetValues(typeof(InvoiceNotificationPreferenceTypes)))
                                                    {
                                                        if ((InvoiceNotificationPreferenceTypes)pref != InvoiceNotificationPreferenceTypes.None)
                                                        {
                                                            <div class="col-sm-12 col-6">
                                                                <div class="radio">
                                                                    <label>
                                                                        @Html.RadioButtonFor(s => s.OrderAdditionalDetails.BOLInvoicePreferenceTypes, pref, new { onchange = "updateInvoiceNotificationPreference()" })
                                                                        @(((InvoiceNotificationPreferenceTypes)pref).GetDisplayName())
                                                                    </label>
                                                                </div>
                                                                @if ((InvoiceNotificationPreferenceTypes)pref == InvoiceNotificationPreferenceTypes.SendPDIDeliveryDetails)
                                                                {
                                                                    <div class="ml25 checkbox">
                                                                        @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsIncludePricing, new { @class = "no-hidden-click", onchange = "updateIncludePricingForPDI();" })
                                                                        <label class="" for="IsIncludePricing">@Resource.lblIncludePricing</label>
                                                                    </div>
                                                                }
                                                            </div>
                                                        }
                                                    }
                                                    <div class="col-sm-12 col-6">
                                                        <div class="radio mb5">
                                                            <label>

                                                                @Html.RadioButtonFor(s => s.OrderAdditionalDetails.BOLInvoicePreferenceTypes, InvoiceNotificationPreferenceTypes.None, new { onchange = "updateInvoiceNotificationPreference()" })
                                                                @((InvoiceNotificationPreferenceTypes.None).GetDisplayName())
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="border-b-dash mt15 mb15 clearboth"></div>
                                    </div>
                                }
                                else
                                {
                                    <div class="col-sm-12">
                                        <h4>@Resource.lblInvoiceNotificationInstructions</h4>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class='pa text-center bg-white delivery-instructions-loader loading-wrapper hide-element'>
                                                    <span class='spinner-small pa col-1'></span>
                                                </div>
                                                <div class="row">
                                                    <label>
                                                        @Html.RadioButtonFor(s => s.OrderAdditionalDetails.BOLInvoicePreferenceTypes, InvoiceNotificationPreferenceTypes.SendPDIDeliveryDetails, new { onchange = "updateInvoiceNotificationPreference()" })
                                                        @InvoiceNotificationPreferenceTypes.SendPDIDeliveryDetails.GetDisplayName()
                                                    </label>
                                                    @*@if (Model.FuelDetails.IsMarineLocation && !Model.IsSupressOrderPricing)
                                {
                                    <div class="ml25 checkbox">
                                        @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsIncludePricing, new { @class = "no-hidden-click", onchange = "updateIncludePricingForPDI();" })
                                        <label class="" for="IsIncludePricing">@Resource.lblIncludePricing</label>
                                    </div>
                                }*@
                                                </div>
                                                <div class="row">
                                                    <label>
                                                        @Html.RadioButtonFor(s => s.OrderAdditionalDetails.BOLInvoicePreferenceTypes, InvoiceNotificationPreferenceTypes.None, new { onchange = "updateInvoiceNotificationPreference()" })
                                                        @InvoiceNotificationPreferenceTypes.None.GetDisplayName()
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }

                            }

                            @if (!Model.IsSupressOrderPricing)
                            {
                                <div class="col-sm-12">
                                    @if (Model.TypeOfFuel == (int)ProductDisplayGroups.OtherFuelType || Model.TypeOfFuel == (int)ProductDisplayGroups.AdditiveFuelType)
                                    {
                                        if (!Model.IsBrokeredOrder)
                                        {
                                            using (Html.BeginForm("SaveOtherPorductTypeTaxes", "Order", new { area = "Supplier" }, FormMethod.Post, new { id = "frmOtherProductTypeTaxes" }))
                                            {
                                                @Html.HiddenFor(m => m.Id)
                                                <h4>@Resource.headingOtherProductTaxes</h4>


                                                <div class="row @(Model.StatusId == (int)OrderStatus.Open ? "" : "subSectionOpacity pntr-none")">
                                                    <div class="col-sm-12">
                                                        <div class="checkbox mt0">
                                                            <label>
                                                                @Html.CheckBoxFor(m => m.IsOtherFuelTypeTaxesGiven, new { onchange = "showHideonSectionCheckbox(this,'addtax,btnAddTaxes,addTaxBtns')" }) @Resource.lblIsOtherFuelTypeTaxesEnabled
                                                            </label>
                                                            <i class="fa fa-info-circle ml5" data-toggle="tooltip" data-placement="top" title="@Resource.msgTaxOtherProducts"></i>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 col-md-10 addtax">
                                                        <div id="otherProductType-tax-section" class="partial-section">
                                                            <div class="partial-block-collection-section">
                                                                @if (Model.TaxDetailsViewModel != null && Model.TaxDetailsViewModel.Count() > 0)
                                                                {
                                                                    foreach (var otherProductTax in Model.TaxDetailsViewModel)
                                                                    {
                                                                        Html.RenderPartial("_PartialOtherProductTax", otherProductTax);
                                                                    }
                                                                }
                                                            </div>
                                                            <div class="form-group col-md-12 pl0 mt7 btnAddTaxes">
                                                                <a href="javascript:void(0)" class="add-partial-block" data-url="@Url.Action("OtherProductTax", "Order")"><span class="fa fa-plus-circle"></span> @Resource.lblAddTaxes</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-12 text-right addTaxBtns" id="taxesSaveBtnDiv">
                                                        <div class="dib">
                                                            <input type="button" id="Cancel" value="@Resource.btnLabelCancel"
                                                                   class="btn btnsubmit-partialcollection" onclick="btnCancel();" />
                                                            <input type="submit" id="Submit" value="@Resource.btnLabelSave" class="btn btn-primary btn-lg btnsubmit-partialcollection" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="border-b-dash mt15 mb15 clearboth"></div>
                                            }
                                        }
                                        else
                                        {
                                            <h4>@Resource.headingTaxesOtherProducts</h4>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <table class="table table-hover mb0">
                                                        <thead>
                                                            <tr>
                                                                <th>@Resource.lblType</th>
                                                                <th>@Resource.lblAmount</th>
                                                                <th>@Resource.lblDescription</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var tax in Model.TaxDetailsViewModel)
                                                            {
                                                                <tr>
                                                                    <td>
                                                                        @(CommonHelperMethods.GetName<OtherProductTaxPricingType>(tax.TaxPricingTypeId))
                                                                    </td>
                                                                    <td>
                                                                        @tax.TaxRate
                                                                    </td>
                                                                    <td>
                                                                        @tax.TaxDescription
                                                                    </td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="border-b-dash mt15 mb15 clearboth"></div>
                                        }
                                    }
                                </div>
                            }
                            <div class="col-sm-12 pb15" id="Delivery_Info">
                                <h4>@Resource.headingDelivery</h4>
                                <div class="row">
                                    <div class="col-6 col-sm-2 mb10">
                                        <label class="f-normal">@Resource.lblDeliveryDateOrRange</label>
                                        <div id="auto-lbldeliverydate">
                                            @Model.FuelDeliveryDetails.StartDate.ToString(Resource.constFormatDate)
                                            @if (Model.FuelDeliveryDetails.EndDate != null)
                                            {
                                                @($" - {Model.FuelDeliveryDetails.EndDate.Value.ToString(Resource.constFormatDate)}")
                                            }
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-2 mb10">
                                        <label class="f-normal">@Resource.lblDeliveryWindow</label>
                                        <div>
                                            <span id="auto-lbldeliverytimefrom">@Model.FuelDeliveryDetails.StartTime</span>
                                            @Resource.lblSingleHyphen
                                            <span id="auto-lbldeliverytimeto">@Model.FuelDeliveryDetails.EndTime</span>
                                        </div>
                                    </div>
                                    <div class="col-6 col-sm-2 mb10">
                                        <label class="f-normal">@Resource.lblRequestType</label>
                                        <div id="auto-lbldeliverytype">@(Model.FuelDeliveryDetails.DeliveryTypeId == ((Int16)DeliveryType.OneTimeDelivery) ? Resource.lblSingle : Resource.lblMultiple)</div>
                                    </div>
                                    @if (Model.FuelDeliveryDetails.DeliveryTypeId == (int)DeliveryType.MultipleDeliveries)
                                    {
                                        <div class="col-6 col-sm-3">
                                            <label class="f-normal">@Resource.lblEstimatedQuantityPerDelivery</label>
                                            <div>@(Model.EstimatedGallonsPerDelivery)</div>
                                        </div>
                                    }
                                    @if (Model.IsBrokeredOrder && Model.FuelRequestTypeId == (int)FuelRequestType.BrokeredFuelRequest)
                                    {
                                        <div class="col-sm-3 dispatchRetained-details">
                                            <div class='pa text-center bg-white dispatchRetained-loader loading-wrapper hide-element'>
                                                <span class='spinner-small pa col-1'></span>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <label class="f-normal">@Resource.lblDispatch</label>
                                                    <a id="edit-isRetained" href="javascript:void(0)" onclick="editIsDispatchRetained();"><i class="fa fa-edit"></i></a>
                                                    <div class="checkbox mt0 fs12">
                                                        <label>
                                                            @Html.CheckBoxFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer, new { @disabled = true })
                                                            <input type="hidden" value="@Model.FuelDeliveryDetails.IsDispatchRetainedByCustomer" id="hdnIsDispatchRetained" />
                                                            @Resource.lblDispatchAbilityToRetain
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 text-right isRetained-buttons  hide-element mt10">
                                                    <input id="cancelEditRetained" type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions"
                                                           onclick="cancelEditIsDispatchRetained()" />
                                                    <input type="button" value=" @Resource.btnLabelSave" class="btn btn-sm btn-primary" onclick="updateIsDispatchRetained()" />
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else if (Model.IsBrokeredOrder)
                                    {
                                        <div class="col-6 col-sm-2 mb10">
                                            <label class="f-normal">@Resource.lblIsRetained</label>
                                            <div>@((Model.FuelDeliveryDetails.IsDispatchRetainedByCustomer).ToYesNo())</div>
                                        </div>
                                    }
                                </div>
                                @if (Model.FuelDeliveryDetails.DeliveryTypeId == (int)DeliveryType.MultipleDeliveries)
                                {
                                    <div class="row">
                                        <div class="col-sm-12 mb10">
                                            <a href="javascript:void(0)" onclick="triggerEvent('.schedule-tab','click')" id="linkViewSchedules" class="mr20">
                                                @Resource.lblViewDeliverySchedules
                                            </a>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="border-b-dash ma15 clearboth"></div>
                            <div class="col-sm-12 pb15">
                                <div class="overflow-h">
                                    <h4 class="float-left">@Resource.headingDriverApplication  <a id="edit-order-additional-details" href="javascript:void(0)" class="ftl-controls ml5" onclick="editOrderAddditionalDetails(this, 'order-additional-details', 'order-additional-buttons'); focusOnFirst(this,'order-additional-details')"><i class="fa fa-edit"></i></a> </h4>
                                </div>
                                <div class="row">
                                    @if (Model.OrderAdditionalDetails != null)
                                    {
                                        <div class="col-sm-6">
                                            <div class="row order-additional-details">
                                                <div class='pa text-center bg-white order-additional-loader loading-wrapper hide-element'>
                                                    <span class='spinner-small pa col-1'></span>
                                                </div>
                                                @if (Model.OrderAdditionalDetails.Carrier != null)
                                                {
                                                    <div class="col-sm-4 mb10 ftl-controls disable-controls">
                                                        <label class="f-normal">@Resource.lblCarrier</label>

                                                        @Html.PartialFor("~/Views/Shared/_PartialCarrier.cshtml", m => m.OrderAdditionalDetails.Carrier)

                                                    </div>
                                                }
                                                @if (Model.OrderAdditionalDetails.SupplierSource != null)
                                                {
                                                    <div class="col-sm-4 mb10 ftl-controls disable-controls">
                                                        @Html.LabelFor(m => m.OrderAdditionalDetails.SupplierSource.Name, new { @class = "f-normal" })

                                                        @Html.PartialFor("~/Views/Shared/_PartialSupplierSource.cshtml", m => m.OrderAdditionalDetails.SupplierSource)
                                                    </div>
                                                }
                                                <div class="col-sm-4 mb10 ftl-controls disable-controls">
                                                    @Html.LabelFor(m => m.OrderAdditionalDetails.SupplierSource.ContractNumber, new { @class = "f-normal" })
                                                    @Html.TextBoxFor(m => m.OrderAdditionalDetails.SupplierSource.ContractNumber, new { @class = "form-control", @placeholder = @Resource.lblContractNumber })
                                                </div>
                                                @*<div class="col-sm-3 mb10 ftl-controls disable-controls">
                                @Html.LabelFor(m => m.OrderAdditionalDetails.LoadCode, new { @class = "f-normal" })
                                @Html.TextBoxFor(m => m.OrderAdditionalDetails.LoadCode, new { @class = "form-control", @placeholder = @Resource.lblLoadCode })
                            </div>*@
                                                <div class="col-sm-9 ftl-controls">
                                                    <div class="checkbox mb0 disable-controls">
                                                        <label>
                                                            @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsDriverToUpdateBOL)
                                                            @Resource.lblDriverToUpdateBOL
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 ftl-controls">
                                                    <div class="checkbox mb0 disable-controls">
                                                        <label>
                                                            @Html.CheckBoxFor(m => m.FuelDeliveryDetails.IsBolImageRequired)
                                                            @Resource.lblBOLImageRquired
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 ftl-controls">
                                                    <div class="checkbox mb0 disable-controls">
                                                        <label>
                                                            @Html.CheckBoxFor(m => m.FuelDeliveryDetails.IsDropImageRequired)
                                                            @Resource.lblDropImageRquired
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 ftl-controls">
                                                    <div class="checkbox mb0 disable-controls">
                                                        <label>
                                                            @Html.CheckBoxFor(m => m.IsSignatureEnabled)
                                                            @Resource.lblEnableSignature (@Resource.lblOptional)
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 text-right order-additional-buttons hide-element">
                                                    <input type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions" onclick="cancelEditOrderAdditionalDetails('edit-order-additional-details','order-additional-details','order-additional-buttons')" />
                                                    <button class="btn btn-primary" onclick="updateOrderAdditionalOtherDetails()">
                                                        @Resource.btnLabelSave
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    <div class="col-sm-5">
                                        <div class="row">
                                            <div class="col-sm-5 col-12">
                                                <label class="f-normal">@Resource.lblAssignedDriver</label>
                                                <div id="driver-name">@Model.DriverName</div>
                                                <div class="mt5 pr">
                                                    @if ((CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier) && Model.StatusId == (int)OrderStatus.Open && Model.IsEndSupplier && !Model.IsBrokeredOrder)
                                                    {
                                                        <a id="LinkAssignDriver" href="javascript:void(0)" onclick="toggleElement('assign-driver')"><span class="fa fas fa-user-check"></span>&nbsp;@Resource.btnLabelAssignDriver</a>
                                                    }

                                                    <div class="col-sm-12 hide-element border z-index5 pa bg-white assign-driver shadow-b" id="assign-driver-modal">
                                                        <div class="pa bg-white top0 left0 z-index5 loading-wrapper hide-element"><span class='spinner-dashboard pa'></span></div>
                                                        <i class="fa fa-times pull-right mt5 mb10" aria-hidden="true" onclick="toggleElement('assign-driver')"></i>
                                                        <div class="form-group">
                                                            @Html.DropDownListFor(m => m.DriverId, new SelectList(CommonHelperMethods.GetAllDrivers(CurrentUser.CompanyId), "Id", "Name", Model.DriverId),
                                                             string.Format(Resource.valMessageSelect, Resource.lblDriver), new { @class = "form-control" })
                                                        </div>
                                                        <div class="form-group text-right">
                                                            <input type="button" value="@Resource.btnLabelCancel" id="btnCancel" class="btn" onclick="toggleElement('assign-driver')" />
                                                            @if (Model.DriverId == null || Model.FuelDeliveryDetails.DeliveryTypeId == (int)DeliveryType.OneTimeDelivery)
                                                            {
                                                                <input type="button" value="@Resource.btnLabelSave" id="btnSaveDriver" class="btn btn-primary btn-sm" onclick="saveDriver()" />
                                                            }
                                                            else
                                                            {
                                                                //data-toggle="confirmation" data-content="@Resource.lblDriverConfirmation" data-on-confirm="saveDriver"
                                                                <input type="button" value="@Resource.btnLabelSave" id="btnSaveDriver" class="btn btn-primary btn-sm"
                                                                       data-toggle="confirmation" data-content="@Resource.lblDriverConfirmation" data-confirmation-event="saveDriver" />
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (!Model.FuelDetails.IsMarineLocation)
                            {
                                <!-- Order Badge Details -->
                                <div class="col-sm-12 display-badge-details mt30">
                                    <div class="overflow-h">
                                        <h4 class="float-left">@Resource.headingBadgeDetails</h4>
                                        <a class="fa fa-edit fs14 float-left ml10 mt15" aria-hidden="true" onclick="showHideControls(null, 'edit-badge-details', 'display-badge-details')"></a>
                                    </div>
                                    @if ((@Model.OrderBadgeDetails.TerminalBulkBadge != null && @Model.OrderBadgeDetails.TerminalBulkBadge.Count > 0) ||
                                    (@Model.OrderBadgeDetails.BadgeNo1 != null || @Model.OrderBadgeDetails.BadgeNo2 != null
                                    || @Model.OrderBadgeDetails.BadgeNo3 != null))
                                    {
                                        <table class="table table-hover margin bottom details-table">
                                            <thead>
                                                <tr>
                                                    <th>@Resource.lblBadgeType</th>
                                                    <th>@Resource.gridTerminalBulkPlantName</th>
                                                    <th>@Resource.lblBadgeNo1</th>
                                                    <th>@Resource.lblBadgeNo2</th>
                                                    <th>@Resource.lblBadgeNo3</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (@Model.OrderBadgeDetails.BadgeNo1 != null || @Model.OrderBadgeDetails.BadgeNo2 != null
|| @Model.OrderBadgeDetails.BadgeNo3 != null)
                                                {
                                                    <tr>
                                                        <td>@Resource.lblCommon</td>
                                                        <td>@Resource.lblHyphen</td>
                                                        <td>
                                                            @if (!string.IsNullOrWhiteSpace(Model.OrderBadgeDetails.BadgeNo1))
                                                            {
                                                                @Model.OrderBadgeDetails.BadgeNo1
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblHyphen
                                                            }
                                                        </td>
                                                        <td>
                                                            @if (!string.IsNullOrWhiteSpace(Model.OrderBadgeDetails.BadgeNo2))
                                                            {
                                                                @Model.OrderBadgeDetails.BadgeNo2
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblHyphen
                                                            }
                                                        </td>
                                                        <td>
                                                            @if (!string.IsNullOrWhiteSpace(Model.OrderBadgeDetails.BadgeNo3))
                                                            {
                                                                @Model.OrderBadgeDetails.BadgeNo3
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblHyphen
                                                            }
                                                        </td>
                                                    </tr>
                                                }
                                                @foreach (var terminalBulk in @Model.OrderBadgeDetails.TerminalBulkBadge)
                                                {
                                                    <tr>
                                                        <td>@(terminalBulk.IsPickupTerminal == true ? Resource.lblTerminalText : Resource.lblBulkPlant)</td>
                                                        <td>@terminalBulk.TerminalBulkPlantName</td>
                                                        <td>
                                                            @if (!string.IsNullOrWhiteSpace(terminalBulk.BadgeNo1))
                                                            {
                                                                @terminalBulk.BadgeNo1
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblHyphen
                                                            }
                                                        </td>
                                                        <td>
                                                            @if (!string.IsNullOrWhiteSpace(terminalBulk.BadgeNo2))
                                                            {
                                                                @terminalBulk.BadgeNo2
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblHyphen
                                                            }
                                                        </td>
                                                        <td>
                                                            @if (!string.IsNullOrWhiteSpace(terminalBulk.BadgeNo3))
                                                            {
                                                                @terminalBulk.BadgeNo3
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblHyphen
                                                            }
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    }
                                    else
                                    {
                                        @Resource.lblHyphen
                                    }
                                </div>

                                <div class="col-sm-12">
                                    <div class="row mt30">
                                        <div class="col-sm-12">
                                            @using (Html.BeginForm("SaveBadgeDetails", "Order", new { area = "Supplier" }, FormMethod.Post, new { id = "update-badge-details-form" }))
                                            {
                                                <div class="edit-badge-details" style="display: none">
                                                    <h4>@Resource.headingBadgeDetails</h4>
                                                    @Html.HiddenFor(m => m.Id)
                                                    @Html.PartialFor("_PartialOrderBadge", m => m.OrderBadgeDetails)
                                                    <div class="row">
                                                        <div class="col-md-12 text-right">
                                                            <input type="button" value="@Resource.btnLabelCancel" class="btn actions" onclick="showHideControls(null,'display-badge-details','edit-badge-details')" />
                                                            <input type="button" id="BadgeDetailsSubmit" value="Save" class="btn btn-primary" onclick="return postBadgeDetails();" />
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <!-- Order Badge Details ends -->
                            }
                            <div class="col-sm-12">
                                <div class="border-b-dash mt15 mb15 clearboth"></div>
                            </div>
                            <div class="border-b-dash ma15 clearboth"></div>
                            <div class="col-sm-12 pb15">
                                <h4>@Resource.headingSpecialInstructions</h4>
                                <div class="row">
                                    <div class="col-12 col-sm-2">
                                        <label class="f-normal">
                                            @Resource.lblSpecialInstruction
                                            <i class="fa fa-info-circle ml5" data-toggle="tooltip" data-placement="top" title="@Resource.infoMessageSpecialInstructions"></i>
                                        </label>
                                        <ol class="pl15" id="auto-lblspecialinstructions">
                                            @if (Model.FuelDeliveryDetails.SpecialInstructions.Count == 0)
                                            {
                                                @Resource.lblHyphen
                                            }
                                            else
                                            {
                                                foreach (var specialInstruction in Model.FuelDeliveryDetails.SpecialInstructions)
                                                {
                                                    <li class="break-word">
                                                        @specialInstruction.Instruction
                                                    </li>
                                                }
                                            }
                                        </ol>
                                    </div>
                                    <div class="col-sm-8">
                                        @Html.PartialFor("~/Views/Shared/_PartialSpecialInstructionAttachment.cshtml", m => m.FuelDeliveryDetails.SpecialInstructionFiles)
                                    </div>
                                </div>
                            </div>
                            <div class="border-b-dash ma15 clearboth"></div>
                            @if (!Model.IsSupressOrderPricing)
                            {
                                <div class="col-sm-12 pb15" id="Pricing_Info">
                                    <h4>@Resource.headingPricing</h4>
                                    <div class="row">
                                        @*<div class="col-sm-1 col-6 mb10">
                        <label class="f-normal">@Resource.lblIndices</label>
                        <div>
                            <div>@(((PricingSource)@Model.FuelDetails.FuelPricing.FuelPricingDetails.PricingSourceId).GetDisplayName())</div>
                        </div>
                    </div>*@
                                        <div id="tier-pricing" class="col-6 col-sm-4">
                                            @if (!Model.FuelDetails.IsTierPricing)
                                            {
                                                <label class="f-normal">@Resource.headingPricing</label>
                                            }
                                            @*<label class="f-normal">@(string.Format(Resource.lblRackPP, Model.FuelDetails.FuelPricing.Currency == Currency.USD ? "PPG" : "PPL"))</label>*@
                                            @if (Model.PricingTypeId == (int)PricingType.Suppliercost && !Model.IsBrokeredOrder)
                                            {
                                                <div id="auto-lblCalculatedPricingppg">@Resource.constSymbolCurrency@Model.CalculatedPricePerGallon @Model.FuelDetails.FuelPricing.Currency</div>
                                            }
                                            @if (Model.FuelDetails.IsTierPricing)
                                            {
                                                <div id="auto-lblpricingppg">@Model.PricePerGallon </div>
                                            }
                                            @if (!Model.FuelDetails.IsTierPricing)
                                            {
                                                <div id="auto-lblpricingppg">@Model.PricePerGallon @Model.FuelDetails.FuelPricing.Currency</div>
                                            }
                                            @*<div id="auto-lblpricingppg">@Model.PricePerGallon @Model.FuelDetails.FuelPricing.Currency</div>*@
                                            @*<label class="f-normal">@(string.Format(Resource.lblRackPP, Model.FuelDetails.FuelPricing.Currency == Currency.USD ? "PPG" : "PPL"))</label>
                            @if (Model.PricingTypeId == (int)PricingType.Suppliercost && !Model.IsBrokeredOrder)
                            {
                                <div id="auto-lblCalculatedPricingppg">@Resource.constSymbolCurrency@Model.CalculatedPricePerGallon @Model.FuelDetails.FuelPricing.Currency</div>
                            }
                        <div id="auto-lblpricingppg">@Model.PricePerGallon @Model.FuelDetails.FuelPricing.Currency</div>*@

                                            @if (Model.FuelDetails.IsTierPricing)
                                            {
                                                @Html.PartialFor("~/Views/Shared/_PartialTierPricingDetails.cshtml", m => m.FuelDetails.FuelPricing.TierPricing);
                                            }
                                        </div>
                                        @if (!string.IsNullOrWhiteSpace(Model.FuelDetails.FuelPricing.CityGroupTerminalName))
                                        {
                                            <div class="col-sm-2 col-6">
                                                <label class="f-normal">@Resource.lblCityGroupTerminal</label>
                                                <div class="break-word" id="auto-lblCityGroupSupplierTerminal">
                                                    @Model.FuelDetails.FuelPricing.CityGroupTerminalName
                                                </div>
                                            </div>
                                        }
                                        @if (Model.PricingCodeId > 0)
                                        {
                                            @*<div class="col-md-2 col-6">
                            <label class="f-normal">@Resource.lblPricingCode</label>
                            <div>
                                @(Model.PricingCode)
                            </div>
                        </div>*@
                                            if (!string.IsNullOrWhiteSpace(Model.PricingCodeDescription))
                                            {
                                                <div class="col-md-2 col-6">
                                                    <label class="f-normal">@Resource.lblDescription</label>
                                                    <div>
                                                        @(Model.PricingCodeDescription)
                                                    </div>
                                                </div>
                                            }
                                        }
                                        @if (Model.PricingTypeId == (int)PricingType.Suppliercost && !Model.IsBrokeredOrder)
                                        {
                                            if (CurrentUser.IsSupplier || CurrentUser.IsSupplierAdmin)
                                            {
                                                <div class="col-6 col-sm-3 mb10 @((Model.StatusId == (int)OrderStatus.Open) ? "" : "disable-controls")">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <div class='pa text-center bg-white global-fuelcost-loader loading-wrapper hide-element'>
                                                                <span class='spinner-small pa col-1'></span>
                                                            </div>
                                                            <div class="form-group">
                                                                <div class="radio">
                                                                    <label>
                                                                        @Html.RadioButtonFor(m => m.SuppplierCostTypeId, (int)SupplierCostTypes.GlobalCost, new { onchange = "focusOnFirst(this, 'global-fuel-cost'); toggleFuelCost(true);" })
                                                                        @Resource.lblUseGlobalFuelCost
                                                                        <i class="fa fa-info-circle ml5" data-toggle="tooltip" data-placement="top" title="@Resource.msgGlobalFuelCost"></i>
                                                                    </label>
                                                                </div>
                                                                <div class="row mt5 global-fuel-cost defaultDisabled">
                                                                    <div class="col-8">
                                                                        <div class="input-group">
                                                                            <div class="input-group-addon currency-symbol">@Model.FuelDetails.FuelPricing.Currency</div>
                                                                            @Html.TextBoxFor(m => m.GlobalFuelCost, new { @class = "form-control datatype-decimal", @disabled = "disabled" })
                                                                        </div>
                                                                        @Html.ValidationMessageFor(m => m.GlobalFuelCost)
                                                                        <span id="responseMsgForGlobalCost" class="fs12"></span>
                                                                    </div>
                                                                    <div id="editGlobalFuelCost" class="col-3 pl0 pt8">
                                                                        <a href="javascript:void(0)" onclick="toggleFuelCostModal()"><i class="fa fa-edit ml5" data-toggle="tooltip" data-placement="top" title="@Resource.msgGlobalFuelCost"></i></a>
                                                                    </div>
                                                                    @*<div class="col-1 pa0 global-fuelcost-loader" hidden>
                                                    <span class='spinner-small'></span>
                                                </div>*@
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-3 col-6 mb10 @((Model.StatusId == (int)OrderStatus.Open) ? "" : "disable-controls")">
                                                    <div class="row">
                                                        <div class="col-sm-12 resetleftspace">
                                                            <div class='pa text-center bg-white current-fuel-cost-loader loading-wrapper hide-element'>
                                                                <span class='spinner-small pa col-1'></span>
                                                            </div>
                                                            <div class="radio">
                                                                <label>
                                                                    @Html.RadioButtonFor(m => m.SuppplierCostTypeId, (int)SupplierCostTypes.SupplierCost, new { onchange = "focusOnFirst(this, 'add-fuel-cost'); toggleFuelCost(false);" })
                                                                    @Resource.lblCurrentFuelCost
                                                                    <i class="fa fa-info-circle ml5" data-toggle="tooltip" data-placement="top" title="@Resource.msgCurrentFuelCost"></i>
                                                                </label>
                                                            </div>
                                                            <div class="row mt5 add-fuel-cost defaultDisabled">
                                                                <div class="col-md-8">
                                                                    <div class="input-group">
                                                                        <div class="input-group-addon currency-symbol">@Model.FuelDetails.FuelPricing.Currency</div>
                                                                        @Html.TextBoxFor(m => m.CurrentFuelCost, new { @class = "form-control datatype-decimal" })
                                                                    </div>
                                                                    @Html.ValidationMessageFor(m => m.CurrentFuelCost)
                                                                    <span id="responseMsgForCurrentCost" class="fs12"></span>
                                                                </div>
                                                                <div class="col-3 pl0 pt8">
                                                                    <input type="button" id="btnSaveCurrentCost" class="btn btn-primary btn-xs" onclick="updateFuelCostForOrder();" value="@Resource.btnLabelSave" />
                                                                </div>
                                                                @*<div class="col-1 pa0 add-fuelcost-loader" hidden>
                                                <span class='spinner-small'></span>
                                            </div>*@
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                if (Model.SuppplierCostTypeId == (int)SupplierCostTypes.GlobalCost)
                                                {
                                                    <div class="col-6 col-sm-2 mb10">
                                                        <label class="f-normal">@Resource.headingGlobalFuelCost</label>
                                                        <div id="fuel-cost">@Resource.constSymbolCurrency@Model.GlobalFuelCost @Model.FuelDetails.FuelPricing.Currency</div>
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="col-sm-2 col-6 mb10">
                                                        <label class="f-normal">@Resource.lblCurrentFuelCost</label>
                                                        <div id="fuel-cost">@Resource.constSymbolCurrency@Model.CurrentFuelCost @Model.FuelDetails.FuelPricing.Currency</div>
                                                    </div>
                                                }
                                            }
                                        }
                                        @if (Model.OrderAdditionalDetails != null)
                                        {
                                            <div class="col-sm-2 col-6">
                                                <label class="f-normal">
                                                    @Resource.lblSupplierAllowance <a id="allowance-edit-button" href="javascript:void(0)" onclick="editOrderAddditionalDetails(this, 'supplier-allowance', 'allowance-actionbuttons'); focusOnFirst(this,'supplier-allowance')"><i class="fa fa-edit"></i></a>
                                                </label>
                                                <div class='pa text-center bg-white allowance-loader loading-wrapper hide-element'>
                                                    <span class='spinner-small pa col-1'></span>
                                                </div>
                                                <div class="form-group supplier-allowance">
                                                    <div class="input-group disable-controls">
                                                        <span class="input-group-addon currency-symbol allowance">@Model.Country.Currency/@Model.UoM</span>
                                                        <input type="hidden" value="@Model.OrderAdditionalDetails.Allowance" id="hdnAllowance" />
                                                        @Html.TextBoxFor(m => m.OrderAdditionalDetails.Allowance, new { @class = "form-control datatype-decimal always" })
                                                    </div>
                                                </div>
                                                @Html.ValidationMessageFor(m => m.OrderAdditionalDetails.Allowance)
                                                <div class="text-right allowance-actionbuttons hide-element">
                                                    <input type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions" onclick="cancelEditOrderAdditionalDetails('allowance-edit-button', 'supplier-allowance', 'allowance-actionbuttons')" />
                                                    <button class="btn btn-primary btn-sm" onclick="updateSupplierAllowance()">
                                                        @Resource.btnLabelSave
                                                    </button>
                                                </div>
                                            </div>
                                        }

                                    </div>
                                </div>
                                <div class="border-b-dash ma15 clearboth"></div>

                                if (Model.IsBuyAndSellOrder)
                                {
                                    <div class="col-sm-12 pb15">
                                        <div class="brokeredorder-details">
                                            <h4>@Resource.headingBuySell</h4>
                                            <div class="row disable-controls">
                                                <div class="col-sm-4 col-md-3">
                                                    <div class="form-group disable-controls">
                                                        <label class="f-normal">@Resource.lblCompanyBrokeringFor</label>
                                                        <div>@Model.ExternalBrokerCompanyName</div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-3">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblBrokerMarkup</label>
                                                        <div>@Resource.constSymbolCurrency@Model.ExternalBrokeredOrder.BrokerMarkUp.GetPreciseValue(2) @Model.FuelDetails.FuelPricing.Currency</div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-3">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblSupplierMarkup</label>
                                                        <div>@Resource.constSymbolCurrency@Model.ExternalBrokeredOrder.SupplierMarkUp.GetPreciseValue(2) @Model.FuelDetails.FuelPricing.Currency</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="border-b-dash ma15 clearboth"></div>

                                }
                                if (Model.IsThirdPartyHardwareUsed)
                                {
                                    <div class="col-sm-12 pb15">
                                        <h4>@Resource.heading3rdPartyHardwareUsed</h4>
                                        <div class="row disable-controls">
                                            <div class="col-sm-3">
                                                <label>
                                                    @Resource.lbl3rdPartyNozzleService
                                                    <i class="fa fa-info-circle ml5" data-toggle="tooltip" data-placement="top" title="@Resource.msgPetroTracSupport"></i>
                                                </label>
                                                @Html.DropDownListFor(m => m.ExternalBrokeredOrder.ThirdPartyNozzleId, new SelectList(CommonHelperMethods.GetThirdPartyNozzles(), "Id", "Name", Model.ExternalBrokeredOrder.ThirdPartyNozzleId), new { @class = "form-control" })
                                            </div>
                                            <div class="col-sm-5">
                                                <label>@Resource.lblInvoicePreferences</label>
                                                <div class="checkbox mt0">
                                                    <label>
                                                        @Html.CheckBoxFor(m => m.IsSendFileToBroker)
                                                        @Resource.lblSendDataFiles
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="mt15">
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblVendorId</label>
                                                        <div>@Model.ExternalBrokeredOrder.VendorId</div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblCustomerNumber</label>
                                                        <div>@Model.ExternalBrokeredOrder.CustomerNumber</div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblShipTo</label>
                                                        <div>@Model.ExternalBrokeredOrder.ShipTo</div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblSource</label>
                                                        <div>@Model.ExternalBrokeredOrder.Source</div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="f-normal">@Resource.lblProductCode</label>
                                                        <div>@Model.ExternalBrokeredOrder.ProductCode</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="border-b-dash ma15 clearboth"></div>
                                }

                                <!-- Fuel Surcharge Freight Cost starts -->

                                <div class="col-sm-12 section-fuelsurcharge-freightfee">
                                    <div class="col-sm-12 display-fuelsurcharge-freightfee">
                                        <div class="overflow-h">
                                            <h4 class="float-left">@Resource.headingFuelSurchargeFreightCost</h4>
                                            <a class="fa fa-edit fs14 float-left ml10 mt15" aria-hidden="true" onclick="showHideControls(null, 'edit-fuelsurcharge-freightfee', 'display-fuelsurcharge-freightfee')"></a>
                                        </div>
                                        @if (Model.OrderAdditionalDetails.IsFuelSurcharge)
                                        {
                                            <div class="col-md-4">
                                                <div class="row">
                                                    <div>@Resource.lblPricingType @Resource.lblSingleHyphen @Model.OrderAdditionalDetails.FuelSurchagePricingType</div>
                                                </div>
                                            </div>
                                            if (@Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.FeeSubTypeId == (int)FeeSubType.FlatFee ||
                                                @Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.FeeSubTypeId == (int)FeeSubType.ByQuantity)
                                            {
                                                @($"{@Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.FeeSubTypeName} {Resource.constSymbolCurrency}{Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.Fee.ToString(ApplicationConstants.DecimalFormat2)} {Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.Currency}")
                                            }
                                            else if (@Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.FeeSubTypeId == (int)FeeSubType.ByDistance)
                                            {
                                                @($"{Resource.lblType}{Resource.lblSingleHyphen} {@Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.FeeSubTypeName}")
                                                if (@Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.DeliveryFeeByQuantity.Count > 0)
                                                {
                                                    <table class="table table-hover margin bottom details-table">
                                                        <thead>
                                                            <tr>
                                                                <th>@Resource.lblFrom</th>
                                                                <th>@Resource.lblUpto</th>
                                                                <th>@Resource.lblFee</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var feeByQuantity in @Model.FuelDeliveryDetails.FuelFees.FuelSurchargeFreightFee.DeliveryFeeByQuantity)
                                                            {
                                                                <tr>
                                                                    <td>@feeByQuantity.MinQuantity.GetCommaSeperatedValue()</td>
                                                                    <td>@(feeByQuantity.MaxQuantity == null ? Resource.lblHyphen : feeByQuantity.MaxQuantity.Value.GetCommaSeperatedValue())</td>
                                                                    <td>@Resource.constSymbolCurrency@feeByQuantity.Fee.ToString(ApplicationConstants.DecimalFormat2) @feeByQuantity.Currency</td>
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                }
                                            }
                                            <div>
                                                <a onclick="showSurchargeTable();" class="mt10 dib mb25" id="lnkSurchargeTable">@Resource.lblViewFuelSurchargeTable</a>
                                            </div>
                                        }
                                        else
                                        {
                                            @Resource.lblHyphen
                                        }

                                    </div>
                                    <div class="row col-sm-12 pl0">
                                        <div class="col-sm-8 pl0">
                                            @using (Ajax.BeginForm("UpdateFuelSurchargeFreightFee", "Order", null, new AjaxOptions
                                            {
                                                HttpMethod = "POST",
                                                OnSuccess = "showUpdateFuelSurchargeFreightFeeSuccessMessage",
                                                OnFailure = "showUpdateFuelSurchargeFreightFeeFailedMessage"
                                            }, new { id = "update-fuelsurcharge-freightfee-form" }))
                                            {
                                                <div class="edit-fuelsurcharge-freightfee" style="display: none">
                                                    <h4>@Resource.headingFuelSurchargeFreightCost</h4>
                                                    @Html.HiddenFor(m => m.Id)
                                                    @{ Html.RenderPartial("_PartialEditFuelSurchargeFreightFee", Model); }
                                                    <div class="row">
                                                        <div class="col-md-12 text-right">
                                                            <input type="button" value="@Resource.btnLabelCancel" class="btn actions" onclick="ResetControls();showHideControls(null,'display-fuelsurcharge-freightfee','edit-fuelsurcharge-freightfee')" />
                                                            <button class="btn btn-primary" type="submit" data-toggle='confirmation' data-popout='true' data-singleton='true'
                                                                    data-placement='top' id="Submit" data-title="This will change the fuel surchage freight cost and will be applicable for future invoices. Do you wish to continue?">
                                                                @Resource.btnLabelSave
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>

                                    </div>
                                    <div class="col-sm-12">
                                        <div class="border-b-dash mt15 mb15 clearboth"></div>
                                    </div>
                                </div>

                                <!-- Fuel Surcharge Freight Cost ends -->

                                if (Model.FuelDeliveryDetails.FuelFees.FuelRequestFees.Count > 0)
                                {
                                    <div class="col-sm-12 freight-cost-section">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <h4 class="freight-cost">@Resource.headingFees</h4>
                                                <div class="row">
                                                    @if (Model.IsThirdPartyHardwareUsed)
                                                    {
                                                        @Html.HiddenFor(m => m.ExternalBrokerId)
                                                    }
                                                    <div class="col-12 mb10">
                                                        <div class="row">
                                                            @Html.Partial("_PartialFuelFeeDetails", Model.FuelDeliveryDetails)
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-4 col-12 mb10 hide-element">
                                                        <label class="f-normal">@Resource.lblDiscountForEarlyPayment</label>
                                                        <div>
                                                            @if (Model.DiscountEarlyPayment.Count > 0)
                                                            {
                                                                foreach (var discount in Model.DiscountEarlyPayment)
                                                                {
                                                                    @($"{discount.DiscountPercent}{Resource.constSymbolPercent} {Resource.lblDiscountPercentage} {discount.WithinDays} {Resource.lblDaysAfterInvoice}")
                                                                }
                                                            }
                                                            else
                                                            {
                                                                @Resource.lblNoDiscount
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mt10">
                                                    @if (Model.DifferentFuelPrices.Count > 0)
                                                    {
                                                        <div class="col-sm-7 col-12 mb10">
                                                            <label class="f-normal">@Resource.lblTier</label>
                                                            <div>
                                                                <table class="table table-hover mb0">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>@Resource.lblFrom</th>
                                                                            <th>@Resource.lblUpto</th>
                                                                            <th>@Resource.lblPriceType</th>
                                                                            <th>@Resource.lblPricePerGallon</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        @if (Model.DifferentFuelPrices.Count > 0)
                                                                        {
                                                                            foreach (var fuelPrice in Model.DifferentFuelPrices)
                                                                            {
                                                                                <tr>
                                                                                    <td>@fuelPrice.MinQuantity.GetCommaSeperatedValue()</td>
                                                                                    <td>@(fuelPrice.MaxQuantity == null ? Resource.lblHyphen : fuelPrice.MaxQuantity.Value.GetCommaSeperatedValue())</td>
                                                                                    @if (fuelPrice.PricingTypeId == (int)PricingType.PricePerGallon)
                                                                                    {
                                                                                        <td>
                                                                                            @Resource.lblPricePerGallon
                                                                                        </td>
                                                                                        <td>
                                                                                            @(fuelPrice.PricePerGallon == null ? Resource.lblHyphen : fuelPrice.PricePerGallon.Value.ToString(ApplicationConstants.DecimalFormat2))
                                                                                        </td>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <td>@Resource.lblRackPrice</td>
                                                                                        <td>
                                                                                            @if (fuelPrice.RackAvgTypeId == (int)RackPricingType.PlusPercent)
                                                                                            {
                                                                                                @($"{Resource.lblRackPlus} {fuelPrice.PricePerGallon}{Resource.constSymbolPercent}")
                                                                                            }
                                                                                            else if (fuelPrice.RackAvgTypeId == (int)RackPricingType.MinusPercent)
                                                                                            {
                                                                                                @($"{Resource.lblRackMinus} {fuelPrice.PricePerGallon}{Resource.constSymbolPercent}")
                                                                                            }
                                                                                            else if (fuelPrice.RackAvgTypeId == (int)RackPricingType.PlusDollar)
                                                                                            {
                                                                                                @($"{Resource.lblRackPlus} {Resource.constSymbolCurrency}{fuelPrice.PricePerGallon} {Model.FuelDetails.FuelPricing.Currency}")
                                                                                            }
                                                                                            else if (fuelPrice.RackAvgTypeId == (int)RackPricingType.MinusDollar)
                                                                                            {
                                                                                                @($"{Resource.lblRackMinus} {Resource.constSymbolCurrency}{fuelPrice.PricePerGallon} {Model.FuelDetails.FuelPricing.Currency}")
                                                                                            }
                                                                                        </td>
                                                                                    }
                                                                                </tr>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <tr>
                                                                                <td colspan="2"> @Resource.lblNoDifferentFuelPrice </td>
                                                                            </tr>
                                                                        }
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <div class="border-b-dash mt15 mb15 clearboth"></div>
                                    </div>
                                }
                                if (!Model.FuelDetails.IsMarineLocation && Model.StatusId == (int)OrderStatus.Open && CurrentUser.IsSupplierCompany && (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier))
                                {
                                    <div class="col-sm-12">
                                        <h4>@Resource.headingTankRental</h4>
                                        <div class="form-check form-check-inline @(Model.IsTankRentalEnabled ? "pntr-none subSectionOpacity" : "")">
                                            @Html.CheckBoxFor(m => m.IsTankRentalEnabled, new { @id = "checkbox-applytankrental", @class = "form-check-input", @onchange = "showHideonCheckbox(this,'tankFrequency-controls')" })
                                            <label class="form-check-label" for="checkbox-applytankrental">@Resource.lblApplyTankRental</label>
                                        </div>
                                    </div>
                                    <div class="col-md-12 tankFrequency-controls @(Model.IsTankRentalEnabled ? "" : "hide-element")">
                                        <div id="tankFrequency-section" class="partial-section">
                                            <div class="partial-block-collection-section">
                                                @if (Model.FuelDetails.TankFrequencies != null && Model.FuelDetails.TankFrequencies.Count() > 0)
                                                {
                                                    foreach (var frequency in Model.FuelDetails.TankFrequencies)
                                                    {
                                                        Html.RenderPartial("~/Views/Shared/TankRentalInvoice/_PartialTankFrequencies.cshtml", frequency);
                                                    }
                                                }
                                            </div>
                                            @if (Model.StatusId == (int)OrderStatus.Open && CurrentUser.IsSupplierCompany && (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier))
                                            {
                                                <div class="row">
                                                    <div class="form-group col-md-12">
                                                        <a id="LinkAddTankSchedule" href="javascript:void(0)" class="add-partial-block" data-url="@Url.Action("AddTankSchedule", "Order", new { area = "Supplier", frId = Model.FuelRequestId })"><i class="fas fa-plus-circle"></i> @Resource.lblAnotherSchedule</a>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    <div class="col-sm-12">
                                        <div class="border-b-dash mt15 mb15 clearboth"></div>
                                    </div>
                                }
                            }
                            
                            <div class="col-sm-12 pb15 section-freight-cost-details">
                                <div class="overflow-h">
                                    <h4 class="float-left">
                                        Freight Cost <a id="edit-freight-cost-details" href="javascript:void(0)" class="ml5"
                                                        onclick="editSourceRegion(this, 'freight-cost-details', 'freight-cost-actionbuttons'); focusOnFirst(this,'freight-cost-details')">
                                            <i class="fa fa-edit"></i>
                                        </a>
                                    </h4>
                                </div>
                                <div class="row">
                                    <div class="col-sm-8">
                                        <div class="row freight-cost-details">
                                            <div class='pa text-center bg-white order-additional-loader loading-wrapper hide-element'>
                                                <span class='spinner-small pa col-1'></span>
                                            </div>

                                            <div class="form-check form-check-inline checkbox mb7 disable-controls">
                                                @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsFreightCost, new { onchange = "ToggleFreightCost(true);"})
                                                <label class="form-check-label ml-1" for="OrderAdditionalDetails_IsFreightCost">Freight Rate</label>
                                            </div>
                                            <div id="freight-cost-section" class="col-sm-12 mb10 disable-controls allowedFreightCostInput">
                                                @Html.PartialFor("~/Views/Shared/_PartialFreightCostDetail.cshtml", m => m)
                                            </div>

                                            <div class="form-check form-check-inline checkbox mb7 allowedFreightCostInput disable-controls">
                                                @Html.CheckBoxFor(m => m.OrderAdditionalDetails.IsFuelSurchargeAuto, new { onchange = "ToggleFuelSurcharge();"})
                                                <label class="form-check-label ml-1" for="OrderAdditionalDetails_IsFuelSurchargeAuto">Fuel Surcharge</label>
                                            </div>
                                            <div id="fuel-surcharge-section" class="col-sm-12 mb10 allowedFuelSurchargeInput disable-controls">
                                                @Html.PartialFor("~/Views/Shared/_PartialFuelSurchargeDetail.cshtml", m => m)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-8 text-right freight-cost-actionbuttons hide-element">
                                        <input type="button" value="@Resource.btnLabelCancel" class="btn btn-sm actions"
                                               onclick="cancelEditSourceRegion('edit-freight-cost-details', 'freight-cost-details', 'freight-cost-actionbuttons')" />
                                        <button class="btn btn-primary btn-sm" onclick="updateFreightRateAndFuelSurchargeForAuto(this)">
                                            @Resource.btnLabelSave
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12 pb15 section-accessorial-fees-details">
                                <div class="overflow-h">
                                    <h4 class="float-left">
                                        Accessorial Fees <a id="edit-Accessorial-Fees-details" href="javascript:void(0)" class="ml5"
                                                            onclick="editAccessorialFeesRegion(this, 'Accessorial-Fees-details', 'Accessorial-Fees-actionbuttons','Edit-Accessorial-Fees','View-Accessorial-Fees'); focusOnFirst(this,'Accessorial-Fees-details')">
                                            <i class="fa fa-edit"></i>
                                        </a>
                                    </h4>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="row Accessorial-Fees-details">
                                            <div class='pa text-center bg-white order-additional-loader loading-wrapper hide-element'>
                                                <span class='spinner-small pa col-1'></span>
                                            </div>

                                            @if (!Model.IsThirdPartyHardwareUsed)
                                            {

                                                <div id="Accessorial-Partial-Fees-section" class="col-sm-12 mb10">
                                                    @using (Ajax.BeginForm("UpdateAccessorialFees", "Order", null, new AjaxOptions
                                                    {
                                                        HttpMethod = "POST",
                                                        OnSuccess = "showUpdateAccessorialSuccessMessage",
                                                        OnFailure = "showUpdateAccessorialFailedMessage"
                                                    }, new { id = "update-fuelsurcharge-freightfee-form" }))
                                                    {
                                                        <div id="section-accessorial-fees-disable" class="mb10 disable-controls">

                                                            @{ Html.RenderPartial("~/Views/Shared/_PartialAccessorialFeesDetail.cshtml", Model); }
                                                        </div>
                                                        <div class="col-md-12 Edit-Accessorial-Fees hide-element">
                                                            @Html.HiddenFor(m => m.Id)
                                                            @{ Html.RenderPartial("_PartialFees", Model.FuelDeliveryDetails.FuelFees); }
                                                            <div class="row">
                                                                <div class="col-md-12 text-right">
                                                                    <input type="button" value="@Resource.btnLabelCancel" class="btn actions" onclick="cancelAccessorialFeesRegion('edit-Accessorial-Fees-details', 'Accessorial-Fees-details', 'Accessorial-Fees-actionbuttons','Edit-Accessorial-Fees','View-Accessorial-Fees')" />
                                                                    <button class="btn btn-primary" type="submit" id="Submit">
                                                                        @Resource.btnLabelSave
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }

                                                </div>

                                                <div class="col-sm-12">
                                                    <div id="Accessorial-Partial-Fees-Details-section" class="row mb10 View-Accessorial-Fees">
                                                        @Html.PartialFor("_PartialFuelFeeDetails", m => m.FuelDeliveryDetails)
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-12 pb15" id="Location_Info">
                                <h4>@Resource.headingJobInformation</h4>
                                <div class="row">
                                    <div class="col-sm-2">
                                        <div class="form-group mb5">
                                            <label class="f-normal">@Resource.lblJobName</label>
                                            <div>@Model.JobName</div>
                                        </div>
                                    </div>
                                    @if (!string.IsNullOrWhiteSpace(Model.DisplayJobID))
                                    {
                                        <div class="col-sm-2">
                                            <div class="form-group mb5">

                                                <label class="f-normal">@Resource.lblKiewitJobID</label>
                                                <div>@Model.DisplayJobID</div>
                                            </div>
                                        </div>
                                    }
                                    @if (Model.CreditCheckTypeId.HasValue && Model.CreditCheckTypeId.Value == (int)CreditCheckTypes.SAP)
                                    {
                                        <div class="col-sm-2">
                                            <div class="form-group mb5">
                                                <label class="f-normal">@Resource.lblTfxLocationId</label>
                                                <div>@CommonHelperMethods.GetTFXLocationId(Model.JobId)</div>
                                            </div>
                                        </div>
                                    }

                                    @if (!string.IsNullOrWhiteSpace(Model.BillToInfo.Address))
                                    {
                                        <div class="col-sm-2">
                                            <div class="form-group mb5">
                                                @{
                                                    StringBuilder address = new StringBuilder();
                                                    var fullAddress = "";
                                                    if (!string.IsNullOrWhiteSpace(Model.BillToInfo.City))
                                                    {
                                                        address.Append(", " + Model.BillToInfo.City);
                                                    }
                                                    if (!string.IsNullOrWhiteSpace(Model.BillToInfo.State.Name))
                                                    {
                                                        address.Append(", " + Model.BillToInfo.State.Name);
                                                    }
                                                    if (!string.IsNullOrWhiteSpace(Model.BillToInfo.ZipCode))
                                                    {
                                                        address.Append(", " + Model.BillToInfo.ZipCode);
                                                    }
                                                    if (!string.IsNullOrWhiteSpace(Model.BillToInfo.County))
                                                    {
                                                        address.Append(", " + Model.BillToInfo.County);
                                                    }
                                                    if (!string.IsNullOrWhiteSpace(Model.BillToInfo.Country.Name))
                                                    {
                                                        address.Append(", " + Model.BillToInfo.Country.Name);
                                                    }
                                                    if (address.ToString() != "")
                                                    {
                                                        fullAddress = address.ToString().TrimStart(',', ' ');
                                                    }
                                                }
                                                <label class="f-normal">@Resource.lblJobSpecificBillTo</label>
                                                <div>
                                                    @Model.BillToInfo.Name <br />
                                                    @Model.BillToInfo.Address
                                                    @if (!string.IsNullOrWhiteSpace(Model.BillToInfo.AddressLine2))
                                                    {
                                                        @(string.IsNullOrWhiteSpace(Model.BillToInfo.Address) ? "" : ", ")
                                                        @Model.BillToInfo.AddressLine2
                                                    }
                                                    @if (!string.IsNullOrWhiteSpace(Model.BillToInfo.AddressLine3))
                                                    {
                                                        @(string.IsNullOrWhiteSpace(Model.BillToInfo.AddressLine2) ? "" : ", ")
                                                        @Model.BillToInfo.AddressLine3 <br />
                                                    }
                                                    else
                                                    {
                                                        <br />
                                                    }
                                                    @fullAddress
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    <div class="col-sm-2 col-6 mb10 ml-5">
                                        <div class="form-group mb5">
                                            <label class="f-normal">@Resource.lblJobAddress</label>
                                            @if (!string.IsNullOrWhiteSpace(Model.JobLocation.City) && !Model.JobLocation.City.Equals(Resource.lblVarious))
                                            {
                                                <div>
                                                    @Model.JobLocation.Address
                                                    <br />
                                                    @if (!string.IsNullOrWhiteSpace(Model.JobLocation.AddressLine2))
                                                    {
                                                        @(string.IsNullOrWhiteSpace(Model.JobLocation.Address) ? "" : ", ")
                                                        @Model.JobLocation.AddressLine2
                                                    }
                                                    @if (!string.IsNullOrWhiteSpace(Model.JobLocation.AddressLine3))
                                                    {
                                                        @(string.IsNullOrWhiteSpace(Model.JobLocation.AddressLine2) ? "" : ", ")
                                                        @Model.JobLocation.AddressLine3 <br />
                                                    }
                                                    @Model.JobLocation.City, @Model.JobLocation.StateCode @Model.JobLocation.ZipCode
                                                </div>
                                            }
                                            else
                                            {
                                                <div>
                                                    @Model.JobLocation.StateCode
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    @if (!string.IsNullOrWhiteSpace(Model.SiteInstructions))
                                    {
                                        <div class="col-sm-2 col-6 mb10">
                                            <div class="form-group mb5">
                                                <label class="f-normal">@Resource.lblSiteInstructions</label>
                                                <div>@Model.SiteInstructions</div>
                                            </div>
                                        </div>
                                    }
                                </div>
                                <div class="row">
                                    @if (Model.FuelRequestTypeId != (int)FuelRequestType.ThirdPartyRequest)
                                    {
                                        <div class="col-md-4 col-2 col-sm-2 mb10">
                                            <label class="f-normal">@Resource.lblSalesTaxExempt</label>
                                            <div id="auto-lbltaxable">
                                                @((Model.IsTaxExempted).ToYesNo())
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-sm-8">
                                            <div class="subSectionOpacity">
                                                <label id="sales-tax-exempt">
                                                    @Html.CheckBoxFor(m => m.IsTaxExempted, new { @class = "disabled", @disabled = "disabled" }) @Resource.lblTaxExempted
                                                </label>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <div class="border-b-dash ma15 clearboth"></div>
                            <div class="col-sm-12 pb15">
                                <h4>@Resource.headingOnsiteContact</h4>
                                <table class="table table-hover margin bottom">
                                    <thead>
                                        <tr>
                                            <th id="auto-lblonsitename">@Resource.gridColumnName</th>
                                            <th id="auto-lblonsiteemail">@Resource.gridColumnEmail</th>
                                            <th id="auto-onsitecontactno">@Resource.gridColumnContact</th>
                                        </tr>
                                    </thead>
                                    <tbody id="auto-tblonsitecontact">
                                        @if (Model.ContactPersons.Count > 0)
                                        {
                                            foreach (var contactPerson in Model.ContactPersons)
                                            {
                                                <tr>
                                                    <td>@contactPerson.Name</td>
                                                    <td>@contactPerson.Email</td>
                                                    <td class="phone">@contactPerson.PhoneNumber</td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <td colspan="2"> @Resource.lblNoContacts </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <div class="border-b-dash ma15 clearboth"></div>
                            @if (Model.IsBrokeredOrder)
                            {
                                <div class="col-sm-12 pb15">
                                    <h4>@Resource.tabHeadingPOContact</h4>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <div class="form-group mb10">
                                                @Html.DropDownListFor(m => m.FuelDeliveryDetails.PoContactId,
                              new SelectList(CommonHelperMethods.GetBrokerPoContact(CurrentUser.CompanyId), "Id", "Name", Model.FuelDeliveryDetails.PoContactId),
                              new { @onchange = "assignNewPoContact();", @class = "form-control" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="border-b-dash mt15 mb15 clearboth"></div>
                            }
                            @if (!Model.IsSupressOrderPricing)
                            {
                                <div class="col-sm-12 pb15">
                                    <div class="display-payment-terms">
                                        <h4>
                                            @Resource.lblPaymentDetails
                                            @if (Model.StatusId == (int)OrderStatus.Open && !Model.IsBrokeredOrder)
                                            {
                                                <a class="fa fa-edit pl10 fs14" aria-hidden="true" onclick="showHideControls(null, 'edit-payment-terms', 'display-payment-terms')"></a>
                                            }
                                        </h4>
                                        <div class="row">
                                            <div class="col-sm-3 col-6 mb10">
                                                <label>@Resource.lblHeaderTerms</label>
                                                <div id="payment-terms">
                                                    @Model.PaymentTermName
                                                    @if (Model.PaymentTermId == (int)PaymentTerms.NetDays)
                                                    {
                                                        <span>@Model.NetDays</span>
                                                    }
                                                </div>
                                            </div>
                                            @if (!Model.FuelDetails.IsMarineLocation)
                                            {
                                                <div class="col-sm-3 col-6 mb10">
                                                    <label>@Resource.lblPaymentMethod</label>
                                                    <div id="payment-terms">
                                                        @if (@Model.PaymentMethod != PaymentMethods.None)
                                                        {
                                                            @Model.PaymentMethod.GetDisplayName()
                                                        }
                                                        else
                                                        {
                                                            @Resource.lblHyphen
                                                        }
                                                    </div>
                                                </div>
                                            }
                                            @if (Model.Qualifications.Count > 0)
                                            {
                                                <div class="col-sm-4 col-6">
                                                    <label class="f-normal">@Resource.lblDBE <i class="fa fa-question-circle ml2" data-toggle="tooltip" data-placement="top" title="@Resource.tooltipDBE"></i></label>
                                                    <div id="auto-lblqualification">
                                                        @Html.Raw(string.Join("<br/>", CommonHelperMethods.GetQualificationNamesById(Model.Qualifications)))
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    <div class="col-sm-12 pl0 pr0">
                                        <div class="pl0 col-sm-12">
                                            @using (Ajax.BeginForm("UpdatePaymentTerms", "Order", null, new AjaxOptions
                                            {
                                                HttpMethod = "POST",
                                                OnSuccess = "showUpdatePaymentTermsSuccessMessage",
                                                OnFailure = "showUpdatePaymentTermsFailedMessage"
                                            }, new { id = "update-payment-terms-form" }))
                                            {

                                                <div class="edit-payment-terms" style="display: none">
                                                    <h4>@Resource.lblPaymentDetails</h4>
                                                    @Html.HiddenFor(m => m.Id)
                                                    @{ Html.RenderPartial("_PartialEditPaymentTerms", Model); }
                                                    <div class="row">
                                                        <div class="col-md-12 text-right">
                                                            <input type="button" value="@Resource.btnLabelCancel" class="btn actions" onclick="ResetPaymentTermControls();showHideControls(null,'display-payment-terms','edit-payment-terms')" />
                                                            <button class="btn btn-primary" type="submit" data-toggle='confirmation' data-popout='true' data-singleton='true'
                                                                    data-placement='top' id="Submit" data-content="Do you wish to continue?" data-title="This will change the payment terms for all future drops.">
                                                                @Resource.btnLabelSave
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>

                                    </div>
                                </div>
                                <div class="border-b-dash ma15 clearboth"></div>
                            }
                            @if (!Model.FuelDetails.IsMarineLocation)
                            {
                                <div class="col-sm-12 pb15">
                                    <h4>@Resource.lblOtherDetails</h4>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group mb10">
                                                <label>@Resource.lblInvoiceNotes</label>
                                                <a class="fa fa-edit pl10 fs14" id="notes-edit-link" onclick="showUpdateInvoiceNotesSection();"></a>
                                                <div class="mtm1 display-invoice-notes">
                                                    @Html.Raw(Model.OrderAdditionalDetails.Notes)
                                                </div>
                                                <div class="edit-invoice-notes">
                                                    <div class="float-left">
                                                        @Html.TextAreaFor(m => m.OrderAdditionalDetails.Notes, new { @class = "form-control edit-invoice-notes-class" })
                                                        @Html.ValidationMessageFor(m => m.OrderAdditionalDetails.Notes, "", new { id = "invoiceNotesValidation", @class = "field-validation-error" })
                                                    </div>
                                                    <div class="mt10">
                                                        <div class='pa text-center bg-white invoice-notes-loader loading-wrapper hide-element'>
                                                            <span class='spinner-small pa col-1'></span>
                                                        </div>
                                                        <div>
                                                            <input id="btnCancelEditNotes" type="button" value="@Resource.btnLabelCancel" class="btn actions" onclick="resetInvoiceNotesControls();" />
                                                            @*data-toggle="confirmation"
                                        data-content="Do you wish to continue?" data-on-confirm="updateInvoiceNotes"*@
                                                            <input id="btnUpdateNotes" type="button" value="@Resource.btnLabelUpdate" class="btn btn-primary"
                                                                   data-toggle="confirmation"
                                                                   data-content="Do you wish to continue?" data-confirmation-event="updateInvoiceNotes" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="border-b-dash ma15 clearboth"></div>

                                <div class="col-sm-12 pb15">
                                    <h4>General Notes</h4>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="list-group">
                                                @if (Model.GeneralNotesHistory != null && Model.GeneralNotesHistory.Count > 0)
                                                {
                                                    foreach (var note in Model.GeneralNotesHistory)
                                                    {
                                                        <a href="javascript:void(0)" class="list-group-item list-group-item-action">
                                                            <div class="d-flex w-100 justify-content-between">
                                                                <h3 class="mb-1 user-name">@note.UserName</h3>
                                                                <small>@note.CreatedDate</small>
                                                            </div>
                                                            <p class="mb-1">@note.Note</p>
                                                        </a>
                                                    }
                                                }
                                                else
                                                {
                                                    <div>
                                                        <h3>--</h3>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="border-b-dash ma15 clearboth"></div>
                            }
                        </div>
                    </div>
                </div>
                @if (Model.FuelDeliveryDetails.DeliveryTypeId == (int)DeliveryType.MultipleDeliveries)
                {
                    <div id="order-deliveryschedules" class="hide-element">
                        @if (Model.IsEndSupplier == true && !Model.IsBrokeredOrder && !Model.IsRetailJob && !Model.FuelDeliveryDetails.IsDispatchRetainedByCustomer)
                        {
                            if (Model.CurrentOrderVersionToEdit != null)
                            {
                                using (Html.BeginForm("SaveDeliverySchedules", "Order", new { area = "Supplier" }, FormMethod.Post, new { id = "deliveryschedule-form", @class = "no-tab-change" }))
                                {
                                    @Html.HiddenFor(m => m.Id)
                                    @Html.HiddenFor(m => m.FuelDeliveryDetails.OrderVersion)
                                    <div class="col-sm-12 @((Model.StatusId == (int)OrderStatus.Open) ? "" : "disable-controls")">
                                        <div class="row well mb15">
                                            <div class="col-sm-12">
                                                <h4>@Resource.headingSchedule</h4>
                                                <div class="row">
                                                    <div class="col-md-12 schedule-controls">
                                                        <div id="delivery-schedule-section" class="partial-section">
                                                            <div class="partial-block-collection-section">
                                                                @if (Model.CurrentOrderVersionToEdit.DeliverySchedules != null && Model.CurrentOrderVersionToEdit.DeliverySchedules.Count() > 0)
                                                                {
                                                                    foreach (var deliverySchedule in Model.CurrentOrderVersionToEdit.DeliverySchedules)
                                                                    {
                                                                        Html.RenderPartial("_PartialDeliveryScheduleSupplier", deliverySchedule);
                                                                    }
                                                                    <input type="hidden" id="SaveButtonEnable" />
                                                                }
                                                            </div>
                                                            @if (Model.StatusId == (int)OrderStatus.Open && (CurrentUser.IsSupplierCompany || CurrentUser.IsCarrierCompany) && (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier || CurrentUser.IsCarrierAdmin || CurrentUser.IsCarrier || CurrentUser.IsDispatcher))
                                                            {
                                                                <div class="row">
                                                                    <div class="form-group col-md-12">
                                                                        <a id="LinkAddDeliverySchedule" href="javascript:void(0)" class="add-partial-block" data-url="@Url.Action("DeliverySchedule", "Order", new { area = "Supplier", isFtl = Model.IsFTLEnabled, orderId = Model.Id })"><i class="fas fa-plus-circle"></i> @Resource.btnLabelAddDeliverySchedule</a>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                                @if (@Model.StatusId == (int)OrderStatus.Open && (CurrentUser.IsSupplierCompany || CurrentUser.IsCarrierCompany) && (CurrentUser.IsSupplierAdmin || CurrentUser.IsSupplier || CurrentUser.IsCarrierAdmin || CurrentUser.IsCarrier || CurrentUser.IsDispatcher))
                                                {
                                                    <div class="row">
                                                        <div class="col-sm-12 text-right">
                                                            <div class="dib">
                                                                <input type="button" id="Cancel" value="@Resource.btnLabelCancel"
                                                                       class="btn btnsubmit-partialcollection" onclick="btnCancel();" />
                                                                <input type="button" id="Submit" value="@Resource.btnLabelSave" class="btn btn-lg btn-primary btnsubmit-partialcollection btnSubmitSchedule" onclick="return submitForm();" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        }
                        else
                        {
                            <div class="row">
                                <div class="col-sm-12">
                                    <h4>@Resource.headingDelivery</h4>
                                    <div class="col-md-12">
                                        <div class="row well">
                                            <div class="col-md-12">
                                                @if (Model.DeliverySchedules != null && Model.DeliverySchedules.Count > 0)
                                                {
                                                    <table class="table table-hover mb0 details-table">
                                                        <thead>
                                                            <tr>
                                                                <th>@Resource.lblType</th>
                                                                <th>@Resource.lblNeeded</th>
                                                                <th>@Resource.lblFrom</th>
                                                                <th>@Resource.lblTo</th>
                                                                <th>@Model.FuelDetails.FuelQuantity.UoM</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var schedule in Model.DeliverySchedules)
                                                            {
                                                                <tr>
                                                                    <td>@schedule.ScheduleTypeName</td>
                                                                    <td>
                                                                        @((schedule.ScheduleType == (int)DeliveryScheduleType.Weekly || schedule.ScheduleType == (int)DeliveryScheduleType.BiWeekly) ? string.Join(", ", schedule.ScheduleDayNames)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            : schedule.ScheduleDate.ToString(Resource.constFormatDate))
                                                                    </td>
                                                                    <td>@schedule.ScheduleStartTime</td>
                                                                    <td>@schedule.ScheduleEndTime</td>
                                                                    @if (@schedule.ScheduleQuantityType != ScheduleQuantityType.Quantity)
                                                                    {
                                                                        <td>@schedule.ScheduleQuantityType.GetDisplayName()</td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td>@schedule.ScheduleQuantity.GetCommaSeperatedValue()</td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                }
                                                else
                                                {
                                                    @Resource.lblHyphen
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        <div class="row">
                            <div class="col-sm-12">
                                <h4>@Resource.headingMissedSchedules</h4>
                                <div class="row">
                                    <div class="col-md-12">
                                        @Html.Partial("_PartialMissedSchedulesGrid", new OrderMissedSchedulesViewModel() { OrderId = Model.Id, IsEndSupplier = Model.IsEndSupplier, IsBrokeredOrder = Model.IsBrokeredOrder, IsOpenOrder = (Model.StatusId == (int)OrderStatus.Open) })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <h4>@Resource.headingHistory</h4>
                                <div class="row">
                                    <div class="col-md-12">
                                        @Html.PartialFor("_PartialDeliveryScheduleHistoryGrid", m => m.Id)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    if ((Model.IsProFormaPo && Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest) ||
                            (Model.FuelRequestTypeId == (int)FuelRequestType.BrokeredFuelRequest && Model.BuyerCompanyId == CurrentUser.CompanyId))
                    {
                        <div id="tab-contents-dropinformation" class="hide-element"></div>
                    }
                }
                @if (Model.FuelRequestTypeId == (int)FuelRequestType.ThirdPartyRequest)
                {
                    <div id="order-supplier-assets" class="hide-element">
                        <div class="row mb15">
                            <div class="col-sm-12">
                                @Html.PartialFor("_PartialSupplierOrderAssetTank", m => m)
                            </div>
                        </div>
                        @if (Model.IsAssetHistoryAvailable)
                        {
                            <div class="row mb15">
                                <div class="col-sm-12">
                                    @Html.PartialFor("_PartialViewAssetHistoryGrid", m => m)
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div id="supplier-asset-grids" class="hide-element">
                        @if (Model.AssetsAssigned > 0)
                        {
                            <div id="order-supplier-assetsInfo">
                                <div class="row mb15">
                                    <div class="col-12 col-md-12">
                                        @Html.PartialFor("_PartialSupplierOrderAssetTank", m => m)
                                    </div>
                                </div>
                            </div>
                        }
                        @if (Model.IsAssetHistoryAvailable)
                        {
                            <div id="order-supplier-assetsHistory">
                                <div class="row mb15">
                                    <div class="col-sm-12">
                                        @Html.PartialFor("_PartialViewAssetHistoryGrid", m => m)
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }

                @if (!Model.IsBrokeredOrder)
                {
                    <div id="brokered-fr-grid" class="hide-element">
                    </div>
                }
                <div id="order-history-grid" class="hide-element">
                </div>
                <div id="ddt-grid" class="hide-element">
                </div>
                <div id="invoices-grid" class="hide-element">
                </div>
                <div id="completed-deliveries-grid" class="hide-element">
                </div>
                <div id="tab-contents-version" class="hide-element">
                </div>
                <div id="order-po" class="hide-element">
                    <div class="row mb15">
                        <div class="col-sm-12">
                            @Html.Action("OrderPoView", "Order", new { area = "Supplier", id = Model.Id })
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @if (Model.IsMultiOrder)
    {
        <div class="modal animated fadeIn" id="modal-multi-orders" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
            <div class="modal-dialog modal-tax" role="document">
                <div class="modal-content">
                    <div class="modal-header no-border">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body pt0 pb0" style="overflow:auto">
                        @{Html.RenderPartial("_PartialSelectBrokeredOrder", Model);}
                    </div>
                </div>
            </div>
        </div>
    }
    <div class="modal animated" id="modal-global-fuelcost" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header no-border">
                    <button type="button" onclick="closeGlobalFuelCostPopup();" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body text-center pt0 pb0">
                    @Html.HiddenFor(m => m.TfxFuelTypeId)
                    @Html.PartialFor("_PartialDashboardGlobalFuelCost", m => m.Country)
                </div>
                <div class="modal-footer no-border">
                </div>
            </div>
        </div>
    </div>
    <div id="email-document-popup-container"></div>
    <div id="add-pickupLocation-modal" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" keyboard="false">
        <div class="modal-dialog  modal-lg modal-dialog-centered">
            @using (Html.BeginForm("ModifyPickUpLocation", "Order", new { area = "Supplier" }, FormMethod.Post, new { role = "form", Id = "Modify-pickup-form" }))
            {
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-body modal-autoscroll">
                        <h4>@Resource.btnLabelAddPickupLocation</h4>
                        <p style="word-wrap: break-word;">
                            <div class="pa bg-white z-index5 loading-wrapper pickup-loader"><span class='spinner-dashboard pa'></span></div>
                            <div id="pick-up-location"></div>
                        </p>
                    </div>
                    <div class="text-right pa15 shadow-t">
                        <button type="button" class="btn" data-dismiss="modal">@Resource.btnLabelCancel</button>
                        <input type="button" onclick="savePickUpLocation()" id="btn-save-pickupterminal" class="btn btn-primary btn-lg" value="@Resource.btnLabelSave" />
                    </div>
                </div>
            }
        </div>
    </div>
</body>
@using (Html.BeginScripts())
{
    @Styles.RenderFormat(SiteKeys.StyleVersion, "~/Content/css/multiple-emails")
    <script src="https://maps.googleapis.com/maps/api/js?key=@(SiteFuel.Exchange.Core.Utilities.AppSettings.GoogleMapApiKey)" type="text/javascript"></script>
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Scripts/js/news-feed")
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Scripts/Main/DeliverySchedules")
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Scripts/Main/NextDeliverySchedules")
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Content/js/scheduleLocation")
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Content/js/multiple-emails")
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Content/js/quantityrange-validate")
    @Scripts.RenderFormat(SiteKeys.ScriptVersion, "~/Script/Main/Order")

<script type="text/javascript">
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
       var  valWBS = '@Model.FuelDeliveryDetails.CustomAttributeViewModel.WBSNumber';



        SetPageCulture('@Model.Culture');
                                var isFtl = '@Model.IsFTLEnabled';
                                var mapsApiKey = '@SiteFuel.Exchange.Core.Utilities.AppSettings.GoogleApiKey';
                                var customerCompany = '@Model.BuyerCompanyId';
                                var fuelSurchargeLink = "@Url.Action("BuyerDetails", "Dashboard", new { area = "Supplier" })";
        var selectedFuelCostTypeId = '@Model.SuppplierCostTypeId';
        var originalFuelCost = '@(Model.SuppplierCostTypeId == (int)SupplierCostTypes.GlobalCost ? Model.GlobalFuelCost : Model.CurrentFuelCost)';
        $('[data-toggle=confirmation]').confirmation({
                                    rootSelector: '[data-toggle=confirmation]',
            html: true
        });

        //$(document).on("confirmed.bs.confirmation", '[data-toggle=confirmation]', function (event) {
        //    savePoNumber();
        //});

        var notificationOrderId = @Model.Id, notificationPoNumber = '@Model.PoNumber';
                                var notificationTargetUrl = '@Url.Action("SendDeliveryNotification", "Order", new { area = "Supplier" })';

                                function submitForm() {
                                    var isValidForm = true;
                                    try {
                $(".endtime").each(function () {
                                            var endTimeVal = $(this).val();
                                            var startTimeVal = $(this).parents('.partial-block').find('.starttime').val();
                                            if (endTimeVal != '' && startTimeVal != '' && endTimeVal != startTimeVal) {
                                                var startTimevalInMinutes = getMinutes(convertTo24Hour(startTimeVal));
                                                var endTimevalInMinutes = getMinutes(convertTo24Hour(endTimeVal));
                                                if (parseInt(startTimevalInMinutes) > parseInt(endTimevalInMinutes)) {
                                                    validationMessageFor($(this).attr('name'), '@ResourceMessages.GetMessage(Resource.valMessageGreaterThanOrEqual, new object[] { Resource.lblEndTime, Resource.lblStartTime })');
                                                    isValidForm = false;
                                                }
                                            }
                                        });

                                        if (isValidForm == true && ValidateAndSubmit()) {
                                            SetLocalStorage(window.location.href, true);
                    $('#deliveryschedule-form').submit();
                                        }
                                        else {
                    $('#Submit').removeAttr('disabled');
                                            return false;
                                        }
                                    }
                                    catch (error) {
                                        console.log(error.message);
                $('#Submit').removeAttr('disabled');
                                        return false;
                                    }
                                }

                                function toggleFuelCostModal() {
            $("#modal-global-fuelcost").modal('toggle');
                                }

        function ValidateAndSubmit() {
            var isValidForm = true;
            var fuelRequestStartDate = '@Model.FuelDeliveryDetails.StartDate.ToString(Resource.constFormatDate)';
            var startDate = new Date(fuelRequestStartDate).setHours(0, 0, 0, 0);
            var endDate, quantity = 0, totalQuantity = 0, jobEndDate = '';

            var deliveryEndDate = '@(Model.FuelDeliveryDetails.EndDate != null ? Model.FuelDeliveryDetails.EndDate.Value.ToString(Resource.constFormatDate) : "")';
            if (deliveryEndDate.length > 0) {
                endDate = new Date(deliveryEndDate).setHours(0, 0, 0, 0);
            }
            else {
                jobEndDate = '@(Model.JobEndDate != null ? Model.JobEndDate.Value.ToString(Resource.constFormatDate) : "")';
                if (jobEndDate.length > 0) {
                    jobEndDate = new Date(jobEndDate).setHours(0, 0, 0, 0);
                }
            }
            quantity = parseInt('@(Model.GallonsOrdered)');
            var scheduleType;
            $('#delivery-schedule-section .partial-block').each(function () {
                var curDate = new Date().setHours(0, 0, 0, 0);
                scheduleType = $(this).find('.schedule-type').val();
                var date = $(this).find('.datepicker').val();
                if (scheduleType == '@((int)DeliveryScheduleType.Weekly)' || scheduleType == '@((int)DeliveryScheduleType.BiWeekly)') {
                    totalQuantity += parseInt($(this).find('.quantity').val()) * $(this).find('.schedule-days').val().length;
                }
                else {
                    totalQuantity += parseInt($(this).find('.quantity').val());
                }
                if (scheduleType == '@((int)DeliveryScheduleType.SpecificDates)' || scheduleType == '@((int)DeliveryScheduleType.Monthly)') {
                    var scheduleDate = new Date(date).setHours(0, 0, 0, 0);
                    var trackableScheduleId = $(this).find('[id$="RescheduledTrackableId"]').length ? $(this).find('[id$="RescheduledTrackableId"]').val() : 0;
                    if (trackableScheduleId > 0) {
                        if (scheduleDate < curDate) {
                            validationMessageFor($(this).find('.datepicker').attr('name'),
                                '@ResourceMessages.GetMessage(Resource.valRescheduleDate)');
                            isValidForm = false;
                        }
                    }

                    if (scheduleDate < startDate || (deliveryEndDate != '' && scheduleDate > endDate)) {
                        validationMessageFor($(this).find('.datepicker').attr('name'),
                            '@ResourceMessages.GetMessage(Resource.valMessageScheduleDate)');
                        isValidForm = false;
                    }
                    if (deliveryEndDate.length == 0 && (jobEndDate != '' && scheduleDate > jobEndDate)) {
                        validationMessageFor($(this).find('.datepicker').attr('name'),
                            '@ResourceMessages.GetMessage(Resource.valMessageScheduleDateExceedsJobDate)');
                        isValidForm = false;
                    }
                }
            });
            if (totalQuantity > quantity) {
                validationMessageFor($('#delivery-schedule-section .partial-block:last').find('.quantity').attr('name'),
                    '@ResourceMessages.GetMessage(Resource.valMessageScheduleQuantity)');
                return false;
            }
            return isValidForm;
        }

        function callCancelWBS()
        {
            $("#FuelDeliveryDetails_CustomAttributeViewModel_WBSNumber").val(valWBS);
        }

        function validateEditDeliverySchedule() {
            var isValidForm = true;
            try {
                var dropEndTimeVal = $('#@Html.IdFor(m => m.FuelDeliveryDetails.EndTime)').val();
                var dropStartTimeVal = $('#@Html.IdFor(m => m.FuelDeliveryDetails.StartTime)').val();
                var dropStartTimevalInSeconds = dropStartTimeVal != '' ? parseInt(getSeconds(convertTo24Hour(dropStartTimeVal))) : 0;
                var dropEndTimevalInSeconds = dropEndTimeVal != '' ? parseInt(getSeconds(convertTo24Hour(dropEndTimeVal))) : 0;
                if (dropStartTimeVal != '' && dropEndTimeVal != '' && dropEndTimeVal != dropStartTimeVal) {
                    if (dropStartTimevalInSeconds > dropEndTimevalInSeconds) {
                        validationMessageFor('@Html.NameFor(m => m.FuelDeliveryDetails.EndTime)', '@ResourceMessages.GetMessage(Resource.valMessageGreaterThan, new object[] { Resource.lblEndTime, Resource.lblStartTime })');
                        isValidForm = false;
                        $('#@Html.IdFor(m => m.FuelDeliveryDetails.EndTime)').focus();
                    }
                }
                var quantity = parseInt($("#@Html.IdFor(m=> m.GallonsOrdered)").val(), 10);
                var totalQuantity = 0;
                var scheduleType;
                $('#delivery-schedule-section .partial-block').each(function () {
                    scheduleType = $(this).find('.schedule-type').val();
                    if (scheduleType == '@((int)DeliveryScheduleType.Weekly)' || scheduleType == '@((int)DeliveryScheduleType.BiWeekly)') {
                        totalQuantity += parseInt($(this).find('.quantity').val()) * $(this).find('.schedule-days').val().length;
                    }
                    else {
                        totalQuantity += parseInt($(this).find('.quantity').val());
                    }
                });
                if (totalQuantity > quantity) {
                    isValidForm = false;
                    validationMessageFor('@Html.IdFor(m=> m.GallonsOrdered)', '@ResourceMessages.GetMessage(Resource.valMessageGreaterThanOrEqual, new object[] { Resource.lblTotalQuantity, Resource.lblScheduleDeliveries })');
                    $('#@Html.IdFor(m=> m.GallonsOrdered)').focus();
                }
                return isValidForm;
            }
            catch (error) {
                console.log(error.message);
                return false;
            }
        }

        function btnCancel() {
            location.href = "@Url.Action("Details", "Order", new { area = "Supplier", id = Model.Id })";
        }

        var currentEntityId = @Model.Id; // for newsfeed
        var newsfeedUrl = "@Url.Action("GetNewsfeed", "Order", new { area = "Supplier" })";

        var globalFuelCost = @Model.GlobalFuelCost;
        var currentFuelCost = @Model.CurrentFuelCost;
        var fuelCostTypeId = @Model.SuppplierCostTypeId;
        $(document).ready(function () {
            toggleOnPrefernceSetting();
            $(document).on('keyup', '.calculated-rental-amount,.tax-percentage', function () { calculateTankTaxAmount(this); });
            setOrderStat(@Model.Id);
            if (@Model.FuelDeliveryDetails.DeliveryTypeId == @((int)DeliveryType.MultipleDeliveries)) {
                getNextSchedules(@Model.Id);
            }

            if ('@Model.OrderAdditionalDetails.FreightPricingMethod' == '@(FreightPricingMethod.Auto)') {
                $(".radio-ManualFreightMethod").attr("disabled", "disabled");
            }

            $("#modal-global-fuelcost").on("hidden.bs.modal", function () {
                var url = '@Url.Action("GetCalculatedFuelCostPrice", "Order")';
                var data = { priceDetailId: @Model.RequestPriceDetailId }
                $.get(url, data, function (response) {
                    $('#auto-lblCalculatedPricingppg').html('$' + response.CalculatedPpg);
                    $('#GlobalFuelCost').val(response.FuelCost);
                    $('#CurrentFuelCost').val(response.FuelCost);
                })
            });
            if ($('#GlobalFuelCost').val() == 0) {
                $('#@Html.IdFor(m => m.SuppplierCostTypeId)').attr("disabled", "disabled");
            }

            var winHeight = $(window).height();
            $(".modal-tax .modal-body").css('max-height', winHeight - 100 + 'px');

            if ('@Model.IsMultiOrder' == 'True') {
                $("#modal-multi-orders").modal("show");
            }
            $(".select2_order_licenses").select2({
                placeholder: "Licenses for Order",
                allowClear: true,
                multiple: true,
                closeOnSelect: false
            });

            $(".select2_order_licenses").on("select2:close", function () {
                var licenses = $("#@Html.IdFor(m => m.OrderLicenses)").val();
                $(this).attr('disabled', 'disabled');
                var url = '@Url.Action("UpdateOrderLicenses", "Order")';
                $.post(url, { 'licenses': licenses, 'orderId': '@Model.Id' }, function (response) {
                    $('#@Html.IdFor(m=>m.OrderLicenses)').removeAttr('disabled');
                });
            });

            SetQuickMessageURL('@AppMessageQueryType.Order',@Model.Id);

            if ('@(Model.StatusId != (int)OrderStatus.Open)' == 'True') {
                $('.partial-block').each(function () {
                    $(this).find("a").attr('readonly', 'readonly').addClass("pntr-none");
                });
            }

            //var previousTab = GetLocalStorage(window.location.href);
            //if (typeof previousTab != 'undefined' && previousTab != null && previousTab != '') {
            //    triggerEvent('.schedule-tab', 'click');
            //    RemoveLocalStorage(window.location.href);
            //}

            var checkIfAddingAssetFromODP = GetLocalStorage('AddingAssetFromODP');
            if (typeof checkIfAddingAssetFromODP != 'undefined' && checkIfAddingAssetFromODP != null && checkIfAddingAssetFromODP != '') {
                triggerEvent('.order-asset-tab', 'click');
                RemoveLocalStorage('AddingAssetFromODP');
            }

            $('#@Html.IdFor(m=>m.IsHidePricingEnabled)').change(function () {
                $(this).attr('disabled', 'disabled');
                var url = '@Url.Action("UpdateTogglePricingDetails", "Order")';
                var data = $(this).is(':checked');
                $.post(url, { 'OrderId': '@Model.Id', 'IsHidePricingEnabled': data, 'IsBrokeredOrder': '@Model.IsBrokeredOrder' }, function (response) {
                    $('#@Html.IdFor(m=>m.IsHidePricingEnabled)').removeAttr('disabled');
                });
            });

            $('#@Html.IdFor(m=>m.FuelDeliveryDetails.IsPrePostDipRequired)').change(function () {
                $(this).attr('disabled', 'disabled');
                var url = '@Url.Action("UpdateIsPrePostDipRequired", "Order")';
                var data = $(this).is(':checked');
                $.post(url, { 'orderId': '@Model.Id', 'isPrePostDipRequired': data }, function (response) {
                    $('#@Html.IdFor(m=>m.FuelDeliveryDetails.IsPrePostDipRequired)').removeAttr('disabled');
                    if (response.StatusCode == @((int)Status.Success)) {
                        msgsuccess(response.StatusMessage);
                    }
                    else {
                        msgerror(response.StatusMessage);
                    }
                });
            });

            $('#@Html.IdFor(m => m.IsFTLEnabled)').change(function () {
                $(this).attr('disabled', 'disabled');
                var url = '@Url.Action("UpdateFTLCheckDetails", "Order")';
                var data = $(this).is(':checked');
                $.post(url, { 'OrderId': '@Model.Id', 'isFTL': data }, function (response) {
                    $('#@Html.IdFor(m => m.IsFTLEnabled)').removeAttr('disabled');
                    if (response.StatusCode == @((int)Status.Success)) {
                        msgsuccess('@Resource.successMessageFTLDetailsUpdated');
                    }
                });
            });

            $(document).on('change', '.schedule-type', function () {
                var url = '@Url.Action("DeliverySchedule", "Order")';
                var data = $(this).val();
                var row = $(this).closest('.partial-block');
                $.get(url, { 'scheduleType': data, 'isFtl': '@Model.IsFTLEnabled', 'orderId': '@Model.Id' }, function (response) {
                    var newElement = $(response);
                    newElement.find("input[type='text']:not([disabled]):not([readonly])").each(function () {
                        if (!($(this).hasClass('timepicker') || $(this).hasClass('quantity')))
                            $(this).val('');
                    });
                    $(row).replaceWith(newElement);
                    parseForm();
                    documentReady(true);
                    enableSubmit();
                });
            });

            var pricingSourceId = $("#@Html.IdFor(m=> m.FuelDetails.FuelPricing.FuelPricingDetails.PricingSourceId)").val();
            $("#@Html.IdFor(m=> m.CurrentFuelCost)").on("input propertychange paste", function () {
                if (currentFuelCost != $("#@Html.IdFor(m=> m.CurrentFuelCost)").val()) {
                    $("#btnSaveCurrentCost").removeAttr("disabled");
                }
                else {
                    $("#btnSaveCurrentCost").attr("disabled", "disabled");
                }
            });
            var terminalUrl = "@Url.Action("GetClosedTerminal", "Order", new { area = "Supplier" })";
            autoCompleteTerminal("#@Html.IdFor(m => m.TerminalName)", terminalUrl, 0, 0, 0, 0, 0, @Model.Id);

            resetInvoiceNotesControls();

            if ('@CurrentUser.IsSupplier' == 'True' || '@CurrentUser.IsSupplierAdmin' == 'True' || '@CurrentUser.IsSupplierAndCarrierCompany' == 'True') {
                completed = function (xhr) {
                    getSupplierPreferenceSetting();
                };
            }

            $(document).on('change', $("#@Html.IdFor(m => m.OrderAdditionalDetails.BOLInvoicePreferenceTypes)"), function () {
                var pref = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.BOLInvoicePreferenceTypes)"]:checked').val();
                if (pref != '@InvoiceNotificationPreferenceTypes.SendPDIDeliveryDetails') {
                    $("#@Html.IdFor(m => m.OrderAdditionalDetails.IsIncludePricing)").addClass('pntr-none subSectionOpacity');
                    $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsIncludePricing)"]').prop('checked', false);
                }
                else {
                    $("#@Html.IdFor(m => m.OrderAdditionalDetails.IsIncludePricing)").removeClass('pntr-none subSectionOpacity');
                }
            });

            $(document).on('change', '#@Html.IdFor(m => m.SourceRegion.SelectedSourceRegions)', function (event) {
                UpdateFreightRateFuelSurchargeAccessorialFees();
            });

            $(document).on('change', '#@Html.IdFor(m => m.SourceRegion.SelectedTerminals)', function (event) {
               UpdateFreightRateFuelSurchargeAccessorialFees();
            });

            $(document).on('change', '#@Html.IdFor(m => m.SourceRegion.SelectedBulkPlants)', function (event) {
                UpdateFreightRateFuelSurchargeAccessorialFees();
            });

            freightPricingMethodChanged();
            ToggleFreightCost(false);
            ToggleFuelSurcharge();
        });

    function UpdateFreightRateFuelSurchargeAccessorialFees() {
        if ('@Model.OrderAdditionalDetails.FreightPricingMethod' == '@(FreightPricingMethod.Auto)') {
            var isFreightCost = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFreightCost)"]:checked').val();
            var isFuelSurcharge = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFuelSurchargeAuto)"]:checked').val();
            if (isFreightCost) {
                $('#@Html.IdFor(m => m.OrderAdditionalDetails.FreightRateRuleId)').val(null);
                validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.FreightRateRuleId)", '@Resource.lblRequired');
            }
            if (isFreightCost) {
                $('#@Html.IdFor(m => m.OrderAdditionalDetails.FuelSurchargeTableId)').val(null);
                validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.FuelSurchargeTableId)", '@Resource.lblRequired');
            }

            $('#@Html.IdFor(m => m.OrderAdditionalDetails.AccessorialFeeId)').val(null);
            $("#showMsgInformation").css("color", "brown").html('@Resource.msgFreightInformation');
        }
    }

    function ToggleFreightCost(flg) {
        var IsFreightCost = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFreightCost)"]:checked').val();
        if (IsFreightCost) {
            $('.allowedFreightCostInput').removeClass('hide-element');
            if (flg) {
                var control = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFuelSurchargeAuto)"]');
                control.prop('checked', false);
            }
        }
        else {
            $('.allowedFreightCostInput').addClass('hide-element');
            $('.allowedFuelSurchargeInput').addClass('hide-element');
        }
    }

    function ToggleFuelSurcharge() {
        var IsFuelSurcharge = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFuelSurchargeAuto)"]:checked').val();
        if (IsFuelSurcharge) {
            $('.allowedFuelSurchargeInput').removeClass('hide-element');
        }
        else {
            $('.allowedFuelSurchargeInput').addClass('hide-element');
        }
    }

        function setOrderStat(orderId) {
            $.get("@Url.Action("GetSupplierOrderStat", "Order", new { area = "Supplier" })?orderId=" + orderId,
                function (response) {
                    $('#auto-lblgallons').html(response.GallonsOrdered);
                    $('#auto-lbldelivered').html(response.GallonsDelivered);
                    $('#auto-lblppg').html(response.AvgPricePerGallon);
                    $('#auto-avgdelivery').html(response.AvgGallonsPerDelivery);
                    $('.currency').html(response.DisplayCurrency);
                    $('.uom').html(response.DisplayUoM);
                    if (response.UoM == 2)
                        $('.avg-ppg').text('@(string.Format(Resource.lblAvgPricePerDrop, Resource.lblPricePerGallon))');
                });
        }

        function getNextSchedules(orderId) {
            $.get("@Url.Action("GetNextDeliverySchedules", "Order", new { area = "Supplier" })?orderId=" + orderId,
                function (response) {
                    var nextSchedules = new NextDeliverySchedule.NextSchedules(response);
                    $('#auto-txtnextdeliveryschedule').html(nextSchedules.getAllSchedules());
                });
        }

        $(document).ready(function () {
            var isGlobal = $("#SuppplierCostTypeId:checked").val() == 1;
            if (isGlobal) {
                $(".add-fuel-cost :input").attr("disabled", "disabled");
                $(".add-fuel-cost").addClass("subSectionOpacity");
                $(".global-fuel-cost").removeClass("subSectionOpacity");
                $("#editGlobalFuelCost").show();
            }
            else {
                $("#editGlobalFuelCost").hide();
                $(".global-fuel-cost").addClass("subSectionOpacity");
                $(".add-fuel-cost").removeClass("subSectionOpacity");
                $("#@Html.IdFor(m=> m.CurrentFuelCost)").removeAttr("disabled");
                $("#btnSaveCurrentCost").attr("disabled", "disabled");
            }
            updateFeesHeader('@Model.IsFTLEnabled' == 'True' ? '@((int)TruckLoadTypes.FullTruckLoad)' : '@((int)TruckLoadTypes.LessTruckLoad)');
            $('.ddl-schedule-qty-type').removeClass('hide-element');
            EnableDisableSaveButton();
            if ($("#@Html.IdFor(m => m.FuelDetails.IsMarineLocation)").val() == 'True')
            {
                $(".section-freightPricingMethod").hide();
            }
            @*if ($("#@Html.IdFor(m => m.FuelDetails.IsMarineLocation)").val() == 'True')
                $("#inv-btn").hide();*@
        });

        $(document).ajaxComplete(function (event, xhr, settings) {
            $('.schedule-trash .show-in-tpo').show();
            $('.ddl-schedule-qty-type').removeClass('hide-element');
        });

        function toggleFuelCost(isGlobal) {
            if (isGlobal == true) {
                $("#responseMsgForCurrentCost").html("");
                $(".add-fuel-cost :input").attr("disabled", "disabled");
                $(".add-fuel-cost").addClass("subSectionOpacity");
                $(".global-fuel-cost").removeClass("subSectionOpacity");
                $("#editGlobalFuelCost").show();
                updateGlobalFuelCost();
            }
            else {
                $("#responseMsgForGlobalCost").html("");
                $("#editGlobalFuelCost").hide();
                $(".global-fuel-cost").addClass("subSectionOpacity");
                $(".add-fuel-cost").removeClass("subSectionOpacity");
                $("#@Html.IdFor(m=> m.CurrentFuelCost)").removeAttr("disabled");
                if (currentFuelCost != $("#@Html.IdFor(m=> m.CurrentFuelCost)").val()) {
                    $("#btnSaveCurrentCost").removeAttr("disabled");
                } else {
                    $("#btnSaveCurrentCost").attr("disabled", "disabled");
                }
                updateFuelCostForOrder();
            }
        }
        function showAutoCompleteForTerminal() {
            if ($("#TerminalName").hasClass('hide')) {
                $("#TerminalName").removeClass("hide");
            }
            $('#auto-lblsuppterminalLbl').hide();
        }

        function assignNewTerminalToOrder(selectedTerminal) {
            var url = '@Url.Action("AssignNewTerminalToOrder", "Order", new { area = "Supplier" })';
            var data = {
                terminalId: selectedTerminal,
                orderId: '@Model.Id',
                IsTierPricedOrder :@Model.FuelDetails.IsTierPricing
            };
            $.post(url, data, function (response) {
                showSuccessErrorMsg(response);
            });
        }

        function assignNewPoContact() {
            var selectedPoContact = $('#@Html.IdFor(m => m.FuelDeliveryDetails.PoContactId)').val();
            var url = '@Url.Action("AssignNewPoContact", "Order", new { area = "Supplier" })';
            var data = {
                poCotactId: selectedPoContact,
                orderId: '@Model.Id'
            };
            $.post(url, data, function (response) {
                if (response.StatusCode == 0) {
                    $('#poContactName').html(response.poContactName);
                    $('#poContactEmail').html(response.poContactEmail);
                    $('#poContactPhoneNumber').html(response.poContactPhoneNumber);
                    msgsuccess(response.Message);
                }
                else {
                    msgerror(response.Message);
                }
            });
        }

        var originalCityTerminalId = @Model.CityGroupTerminalId;

        function assignNewCityGroupTerminalToOrder() {
            var selectedCityTerminal = $('#@Html.IdFor(m => m.CityGroupTerminalId)').val();
            if (originalCityTerminalId != selectedCityTerminal) {
                var url = '@Url.Action("AssignNewCityGroupTerminalToOrder", "Order", new { area = "Supplier" })';
                var data = {
                    terminalId: selectedCityTerminal,
                    orderId: '@Model.Id'
                };
                $.post(url, data, function (response) {
                    showSuccessErrorMsg(response);
                    if (response.indexOf("alert-danger") >= 0) {
                        $('.cityrackterminallist ul li[value="' + originalCityTerminalId + '"]').trigger('cityrackloaded');
                    }
                    else {
                        $('#@Html.IdFor(m => m.CityGroupTerminalId)').val(selectedCityTerminal);
                        originalCityTerminalId = selectedCityTerminal;
                    }
                });
            }
        }
        function updateGlobalFuelCost() {
            $(".global-fuelcost-loader").show();
            globalFuelCost = $('#@Html.IdFor(m => m.GlobalFuelCost)').val();
            fuelCostTypeId = @((int)SupplierCostTypes.GlobalCost);
            if (Number(globalFuelCost) > 0) {
                validationMessageFor($("#@Html.IdFor(m=>m.GlobalFuelCost)").attr('name'), '');
                $("#responseMsgForGlobalCost").html('');
                var url = '@Url.Action("UpdateFuelCurrentCost", "Order", new { area = "Supplier" })';
                var data = {
                    FuelRequestId: '@Model.FuelRequestId',
                    PriceRequestDetailId: '@Model.RequestPriceDetailId',
                    TfxFuelTypeId: '@Model.TfxFuelTypeId',
                    FuelTypeId: '@Model.FuelTypeId',
                    IsGlobalCost: true,
                    FuelCost: globalFuelCost,
                    OrderId: '@Model.Id',
                    JobStateId: '@Model.JobStateId',
                    CountryId: @Model.Country.Id,
                    CurrencyType: @((int)Model.Country.Currency)
                };
                $.post(url, data, function (response) {
                    $('#auto-lblCalculatedPricingppg').html('$' + response.CalculatedPpg);
                    if (response.StatusCode == 0) {
                        $("#responseMsgForGlobalCost").css("color", "green").html(response.Message);
                        selectedFuelCostTypeId = '@((int)SupplierCostTypes.GlobalCost)';
                        originalFuelCost = globalFuelCost;
                    }
                    else
                        $("#responseMsgForGlobalCost").css("color", "red").html(response.Message);
                }).always(function () {
                    $(".global-fuelcost-loader").hide();
                    $("#editGlobalFuelCost").removeAttr("disabled");
                });
            }
            else {
                validationMessageFor($("#@Html.IdFor(m=>m.GlobalFuelCost)").attr('name'), '@ResourceMessages.GetMessage(Resource.valMessageGreaterThanZero, new object[] { Resource.lblFuelCost })');
            }
        }

        function toggleEditWindow(elementClassName) {
            $('.' + elementClassName).toggle();
            var isVisible = $('.' + elementClassName).is(':visible');

            if (isVisible === true) {
                // element is Visible
                validationMessageFor("@Html.NameFor(m => m.PoNumber)", '');
                $('#@Html.IdFor(m => m.PoNumber)').val($('#lblPoNumber').text());
            }
        }

        function toggleMoreContactsWindow(elementClassName) {
            $('.' + elementClassName).toggle();
        }

        function showHideonSectionCheckbox(checkbox, toggleSection) {
            showHideonCheckbox(checkbox, toggleSection);
        }

        function savePoNumber() {
            var poNumber = $('#@Html.IdFor(m => m.PoNumber)').val();
            if ($.trim(poNumber) == '') {
                validationMessageFor("@Html.NameFor(m => m.PoNumber)", '@ResourceMessages.GetMessage(Resource.valMessageInvalid,

                                                                                           new object[] { Resource.lblPoNumber })');
                return false;
            }
            var validationUrl = '@Url.Action("IsValidPONumberInOrder", "Validation", new { area = "" })?orderId=@Model.Id&companyId=@Model.BuyerCompanyId&poNumber=' + poNumber;
            var targetUrl = '@Url.Action("EditPoNumber", "Order", new { area = "Supplier" })?id=@Model.Id&fuelRequestId=@Model.FuelRequestId&isProFormaPo=@Model.IsProFormaPo&poNumber=' + escape(poNumber);
            var lblPoNumberVal = $('#lblPoNumber').text();
            $.post(validationUrl, function (response) {
                if (response == true) {
                    $("#po-edit-modal").find('.loading-wrapper').show();
                    $.post(targetUrl, function (response) {
                        if (response.StatusCode == 0) { // 0=Success, 1=Failed
                            toggleEditWindow('po-edit');
                            lblPoNumberVal = poNumber;
                            $('#lblPoNumber').text(lblPoNumberVal);
                            msgsuccess(response.StatusMessage);
                        }
                    }).always(function () { $("#po-edit-modal").find('.loading-wrapper').hide(); });
                }
                else {
                    validationMessageFor("@Html.NameFor(m => m.PoNumber)", '@ResourceMessages.GetMessage(Resource.valMessageAlreadyExist,

                                                                                               new object[] { Resource.lblPoNumber })');
                }
            });
        }

        function updateWbsNumber() {
            var wbsNumber = $('#@Html.IdFor(m => m.FuelDeliveryDetails.CustomAttributeViewModel.WBSNumber)').val();
            var data = {
                fuelRequestId: @Model.FuelRequestId,
                wbsNumber: wbsNumber
            }
            var targetUrl = '@Url.Action("UpdateWbsNumber", "Order", new { area = "Supplier" })';
            $.post(targetUrl, data, function (response) {
                if (response.StatusCode == 0) {
                    cancelEditOrderAdditionalDetails('edit-wbs-icon', 'wbs-details', 'wbs-buttons');
                    msgsuccess(response.StatusMessage);
                    valWBS = wbsNumber;
                }
            }).always(function () { $(".wbs-details").find('.loading-wrapper').hide(); });
        }

        function updateFuelCostForOrder() {
            $(".add-fuel-cost :input").attr("disabled", "disabled");
            $(".current-fuel-cost-loader").show();
            currentFuelCost = $('#@Html.IdFor(m => m.CurrentFuelCost)').val();
            fuelCostTypeId = @((int)SupplierCostTypes.SupplierCost);
            if (Number(currentFuelCost) > 0) {
                validationMessageFor($("#@Html.IdFor(m => m.CurrentFuelCost)").attr('name'), '');
                $("#responseMsgForCurrentCost").html('');
                var url = '@Url.Action("UpdateFuelCurrentCost", "Order", new { area = "Supplier" })';
                var data = {
                    FuelRequestId: '@Model.FuelRequestId',
                    PriceRequestDetailId: '@Model.RequestPriceDetailId',
                    TfxFuelTypeId: '@Model.TfxFuelTypeId',
                    FuelTypeId: '@Model.FuelTypeId',
                    IsGlobalCost: false,
                    FuelCost: currentFuelCost,
                    SupplierFuelCostTypeId: selectedFuelCostTypeId,
                    OriginalFuelCost: originalFuelCost,
                    OrderId: '@Model.Id',
                    CountryId: @Model.Country.Id,
                    UoM:@((int)Model.UoM),
                    CurrencyType: @((int)Model.Country.Currency)
                };
                $.post(url, data, function (response) {
                    if (response.StatusCode == @((int)Status.Success)) {
                        $("#responseMsgForCurrentCost").css("color", "green").html(response.Message);
                        selectedFuelCostTypeId = '@((int)SupplierCostTypes.SupplierCost)';
                        originalFuelCost = currentFuelCost;
                    }
                    else
                        $("#responseMsgForCurrentCost").css("color", "red").html(response.Message);

                    $('#auto-lblCalculatedPricingppg').html('$' + response.CalculatedPpg);

                }).always(function () {
                    $(".current-fuel-cost-loader").hide();
                    $(".add-fuel-cost :input").removeAttr("disabled");
                    $("#btnSaveCurrentCost").attr("disabled", "disabled");
                });
            }
            else {
                validationMessageFor($("#@Html.IdFor(m=>m.CurrentFuelCost)").attr('name'), '@ResourceMessages.GetMessage(Resource.valMessageGreaterThanZero, new object[] { Resource.lblFuelCost })');
            }
        }

        function updateIncludePricingForPDI() {
            $(".delivery-instructions-loader").show();
            var url = '@Url.Action("UpdateIncludePricingFlagForPDI", "Order", new { area = "Supplier" })';
            var data = {
                orderId: '@Model.Id',
                isIncludePricing: $("#@Html.IdFor(m => m.OrderAdditionalDetails.IsIncludePricing)").is(':checked')
            };

            $.post(url, data, function (response) {
                if (response != null && response != undefined && response.StatusCode == @((int)Status.Success)) {
                    msgsuccess(response.StatusMessage);
                }
                else
                    msgerror('@Resource.gridColumnFailed');
            }).always(function () {
                $(".delivery-instructions-loader").hide();
            });
        }

        function saveDriver() {
            var driverId = $('#@Html.IdFor(m => m.DriverId) option:selected').val();
            var driverName = $('#@Html.IdFor(m => m.DriverId) option:selected').text();
            $("#assign-driver-modal").find('.loading-wrapper').show();
            var targetUrl = '@Url.Action("AssignDriver", "Order", new { area = "Supplier" })?id=@Model.Id&driverId=' + driverId;
            $.post(targetUrl, function (response) {
                if (response.StatusCode == 0) { // 0=Success, 1=Failed
                    msgsuccess(response.StatusMessage);
                    location.href = "@Url.Action("Details", "Order", new { area = "Supplier", id = Model.Id })";
                }
                else {
                    msgerror(response.StatusMessage);
                }
            }).always(function () { $("#assign-driver-modal").find('.loading-wrapper').hide(); });
        }

        function setSelection(driverId) {
            $('select[id$="DriverId"]').each(function () {
                var element = $(this);
                if (!element.hasClass('pntr-none')) {
                    element.find('option').each(function () { $(this).removeAttr('selected') });
                    element.find('option[value="' + driverId + '"]').attr('selected', 'selected');
                }
            });
        }

        function SetDefaultInvoiceType(elem)
        {
            var url = '@Url.Action("SetDefaultInvoiceTypeForOrder", "Order", new { area = "Supplier" })';
            var data = {
                orderId: '@Model.Id',
                defaultInvoiceTypeManual: $(elem).val()
            };
            $.post(url, data, function (response) {

                    if ($(elem).val() == 'False') {
                        // show DDT button
                        $("#btnCreateDDTNew").removeClass("hide-element");
                        $("#btnCreateSplitDropTicket").removeClass("hide-element");
                        $("#btnCreateInvoiceNew").addClass("hide-element");
                        $("#btnCreateSplitInvoice").addClass("hide-element");
                    }
                    else {
                        // show Manual invoice button
                        $("#btnCreateInvoiceNew").removeClass("hide-element");
                        $("#btnCreateDDTNew").addClass("hide-element");
                        $("#btnCreateSplitDropTicket").addClass("hide-element");
                        $("#btnCreateSplitInvoice").removeClass("hide-element");
                    }

                 });
        }

        function UpdateOtherProductTaxesUoM() {
            if ('@Model.FuelDetails.FuelQuantity.UoM' == '@Resource.lblLitres') {
                $('.ddl-other-product-tax').find('option').each(function () {
                    $(this).text($(this).text().replace('@Resource.lblPerGallon', '@Resource.lblPerLitre'));
                });
                $('.taxesRow').find('.input-group-addon').each(function () {
                    $(this).text($(this).text().replace('@(Currency.USD.ToString())','@(Currency.CAD.ToString())'));
                });
            }
		}

        function autoCompleteTerminal(element, url, fuelTypeId, latitude, longitude, countryId, pricingCodeId, orderId) {
			var target = $(element);
			var prevTerminal = $(element).val();
            var terminalId = @Model.TerminalId;
            var pricingSourceId = $("#@Html.IdFor(m=> m.FuelDetails.FuelPricing.FuelPricingDetails.PricingSourceId)").val();
            var isSelected = false;
            target.focus(function () {
                target.val('');
                $(this).autocomplete("search", '  ');
            });
			target.autocomplete({
				search: function (e, u) {
					$(".terminal-loader").show();
				},
				source: function (request, response) {
					var inputData = {
						fuelTypeId: fuelTypeId, latitude: latitude, longitude: longitude, countryId: countryId, pricingCodeId: pricingCodeId, orderId: orderId, terminal: request.term, pricingSourceId: pricingSourceId
					};
					$.ajax({
						url: url,
						type: "GET",
						dataType: "json",
						data: inputData,
						success: function (data) {
							response($.map(data, function (item) {
								return {
									label: item.Name,
									value: item.Id
								};
							}))
						},
						complete: function (event, xhr, settings)
						{
							$(".terminal-loader").hide();
						}
					})
				},
				select: function (event, ui) {
					isSelected = true;
					$('#TerminalName').val(ui.item.label); // display the selected text
					terminalId = ui.item ? ui.item.value : 0;
					prevTerminal = ui.item ? ui.item.label : prevTerminal;
                    if (terminalId != 0) {
                        assignNewTerminalToOrder(terminalId);
                        GetAssignedProductName(terminalId);
                    }

					return false;
				},
				messages: {
					noResults: '',
					results: function () { }
				},
				minLength: 2,
				maxShowItems: 10,
				scroll: true
			});
			$.ui.autocomplete.prototype._resizeMenu = function () {
				var ul = this.menu.element;
				ul.outerWidth(this.element.outerWidth());
			}
		}

        $(document).on("click", ".saveData", function () {
            var editSection = $(this).closest(".edit-section");
            var poNumber = editSection.find("input[type='text']").val();
            var invoiceId = editSection.find("input[type='hidden']").val();
            var valElem = editSection.find('span[data-valmsg-for]');
            var selector = valElem.attr('data-valmsg-for');
            editSection.find(".loading-wrapper").show();

            if ($.trim(poNumber) == '') {
                validationMessageFor(selector, '@ResourceMessages.GetMessage(Resource.valMessageInvalid, new object[] { Resource.lblPoNumber })');
                editSection.find('span[data-valmsg-for]').show();
                return false;
            }
            var targetUrl = '@Url.Action("EditInvoicePoNumber", "Invoice", new { area = "Supplier" })?invoiceId=' + invoiceId + '&poNumber=' + poNumber;
            $.post(targetUrl, function (response) {
                if (response.StatusCode == 0) { // 0=Success, 1=Failed
                    editSection.find("label").show();
                    editSection.find("input").hide();
                    editSection.find("label").text(poNumber);
                    editSection.find("input[type='hidden']").val(response.EntityId);
                    editSection.find("a").show();
                    msgsuccess(response.StatusMessage);
                    editSection.find(".loading-wrapper").hide();
                    editSection.find('span[data-valmsg-for]').hide();
                    location.reload();
                }
            });
        });

        function updateOrderAdditionalOtherDetails() {
            var additionalDetails = {
                LoadCode: $("#@Html.IdFor(m => m.OrderAdditionalDetails.LoadCode)").val(),
                Carrier: {
                    Id: $("#@Html.IdFor(m => m.OrderAdditionalDetails.Carrier.Id)").val(),
                    Name: $("#@Html.IdFor(m => m.OrderAdditionalDetails.Carrier.Name)").val()
                },
                SupplierSource: {
                    Id: $("#@Html.IdFor(m => m.OrderAdditionalDetails.SupplierSource.Id)").val(),
                    Name: $("#@Html.IdFor(m => m.OrderAdditionalDetails.SupplierSource.Name)").val(),
                    ContractNumber: $("#@Html.IdFor(m => m.OrderAdditionalDetails.SupplierSource.ContractNumber)").val()
                },
                IsDriverToUpdateBOL: $("#OrderAdditionalDetails_IsDriverToUpdateBOL").is(':checked')
            };
            var bolImageReq = $("#FuelDeliveryDetails_IsBolImageRequired").is(':checked');
            var dropImageReq = $("#FuelDeliveryDetails_IsDropImageRequired").is(':checked');
            var signImageReq = $("#@Html.IdFor(m => m.IsSignatureEnabled)").is(':checked');
            var data = { viewmodel: additionalDetails, bolImg: bolImageReq, dropImg: dropImageReq, signImg: signImageReq, Id: @Model.Id, updateType: @((int)OrderAdditionalUpdateType.Other) };
            var url = "@Url.Action("UpdateOrderAdditionalDetails", "Order",new { area = "Supplier" })";

            $(".order-additional-loader").show();
            $.post(url, data, function (response) {
                if (response.StatusCode == @((int)Status.Success)) {
                    cancelEditOrderAdditionalDetails('edit-order-additional-details', 'order-additional-details', 'order-additional-buttons');
                    msgsuccess(response.StatusMessage);
                }
                else {
                    msgerror("Update details failed");
                }
            }).always(function () {
                $(".order-additional-loader").hide();
            });
    }

    function freightPricingMethodChanged() {
        var isManual = $("#@Html.IdFor(m => m.SourceRegion.FreightPricingMethod):checked").val() ==='Manual';
        if (isManual) {
            $(".section-approved-terminals-sourceregion").show();
            $(".section-fuelsurcharge-freightfee").show();
            $(".freight-cost-section").show();
            $(".section-source-region-and-terminals").hide();
            $(".section-accessorial-fees-details").hide();
            $(".section-fuel-surcharge-details").hide();
            $(".section-freight-cost-details").hide();
        } else {
            $(".section-source-region-and-terminals").show();
            $(".section-accessorial-fees-details").show();
            $(".section-fuel-surcharge-details").show();
            $(".section-freight-cost-details").show();
            $(".freight-cost-section").hide();
            $(".section-approved-terminals-sourceregion").hide();
            $(".section-fuelsurcharge-freightfee").hide();
        }
    }

    function updateInvoiceNotificationPreference() {
        $(".delivery-instructions-loader").show();
            var additionalDetails = {
                BOLInvoicePreferenceTypes : $("#@Html.IdFor(m => m.OrderAdditionalDetails.BOLInvoicePreferenceTypes):checked").val()
        };
        var bolImageReq = $("#FuelDeliveryDetails_IsBolImageRequired").is(':checked');
        var dropImageReq = $("#FuelDeliveryDetails_IsDropImageRequired").is(':checked');
        var signImageReq = $("#@Html.IdFor(m => m.IsSignatureEnabled)").is(':checked');
        var data = { viewmodel: additionalDetails, bolImg: bolImageReq, dropImg: dropImageReq, signImg: signImageReq, Id: @Model.Id, updateType: @((int)OrderAdditionalUpdateType.InvoiceNotificationPreference) };
            var url = "@Url.Action("UpdateOrderAdditionalDetails", "Order",new { area = "Supplier" })";
        $.post(url, data, function (response) {
            if (response.StatusCode == @((int)Status.Success)) {
                msgsuccess("Invoice Notification Preference Updated");
            }
            else {
                msgerror("Update details failed");
            }
        }).always(function () {
            $(".delivery-instructions-loader").hide();
            toggleOnPrefernceSetting();
        });
        }

    function toggleOnPrefernceSetting() {
        @*if ($("#@Html.IdFor(m => m.OrderAdditionalDetails.BOLInvoicePreferenceTypes):checked").val() == '@(InvoiceNotificationPreferenceTypes.SendPDIDeliveryDetails )') {
            $("#radio-ddt").trigger('click');
            $("#inv-btn").hide();
        } else {*@
        if ($("#@Html.IdFor(m => m.IsSupressOrderPricing)").val()=='True') @*|| $("#@Html.IdFor(m => m.FuelDetails.IsMarineLocation)").val()=='True'*@
            $("#inv-btn").hide();
        else
            $("#inv-btn").show();
        //}
    }
    function updateSupplierAllowance() {
        var additionalDetails = {
            Allowance: $("#@Html.IdFor(m => m.OrderAdditionalDetails.Allowance)").val()
        };
        var bolImageReq = $("#FuelDeliveryDetails_IsBolImageRequired").is(':checked');
        var dropImageReq = $("#FuelDeliveryDetails_IsDropImageRequired").is(':checked');
        var signImageReq = $("#@Html.IdFor(m => m.IsSignatureEnabled)").is(':checked');
        var data = { viewmodel: additionalDetails, bolImg: bolImageReq, dropImg: dropImageReq, signImg: signImageReq, Id: @Model.Id, updateType: @((int)OrderAdditionalUpdateType.SupplierAllowance) };
        var url = "@Url.Action("UpdateOrderAdditionalDetails", "Order", new { area = "Supplier" })";
        if (additionalDetails.Allowance >= 0) {
            validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.Allowance)", "");
        }
        else {
            validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.Allowance)", "Allowance should not be negative value");
            return false;
        }
        $(".allowance-loader").show();
            $.post(url, data, function (response) {
                if (response.StatusCode == @((int)Status.Success)) {
                    $('#hdnAllowance').val(additionalDetails.Allowance);
                    cancelEditOrderAdditionalDetails('allowance-edit-button', 'supplier-allowance', 'allowance-actionbuttons');
                    msgsuccess("Supplier Allowance Updated");
                }
                else {
                    msgerror("Update details failed");
                }
            }).always(function () {
                $(".allowance-loader").hide();
            });
        }


        function editOrderAddditionalDetails(element, displaySection, actionButtons) {
        $(element).hide();
        $("." + displaySection).find("input").attr("disabled", false);
        $("." + actionButtons).show();
        }

        function cancelEditOrderAdditionalDetails(editButton, displaySection, actionButtons) {
            var prevAllowance = $('#hdnAllowance').val();
            $("#@Html.IdFor(m => m.OrderAdditionalDetails.Allowance)").val(prevAllowance);
            validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.Allowance)", "");
            $("#" + editButton).show();
            $("." + displaySection).find("input").attr("disabled", true);
            $("." + actionButtons).hide();
        }
        function editSourceRegion(element, displaySection, actionButtons) {
            $(element).hide();
            //$("#source-region-section").removeClass("disable-controls");
            $("." + displaySection).find(":input").attr("disabled", false);
            $("." + actionButtons).show();
        }

        function cancelEditSourceRegion(editButton, displaySection, actionButtons) {
            $("#" + editButton).show();
            //$("#source-region-section").addClass("disable-controls");
            $("." + displaySection).find(":input").attr("disabled", true);
            $("." + actionButtons).hide();
            //location.reload();
    }

    function editAccessorialFeesRegion(element, displaySection, actionButtons, editAccessorialFees, viewAccessorialFees) {
        $(element).hide();
        $("#section-accessorial-fees-disable").removeClass("disable-controls");
        $("." + displaySection).find(":input").attr("disabled", false);
        $("." + actionButtons).show();
        $("." + editAccessorialFees).show();
        $("." + viewAccessorialFees).hide();
    }
    function cancelAccessorialFeesRegion(editButton, displaySection, actionButtons,editAccessorialFees,viewAccessorialFees) {
        $("#" + editButton).show();
        //$("#source-region-section").addClass("disable-controls");
        $("." + displaySection).find(":input").attr("disabled", true);
        $("." + actionButtons).hide();
        $("." + editAccessorialFees).hide();
        $("." + viewAccessorialFees).show();

        //location.reload();
    }

    function showUpdateInvoiceNotesSection() {
        $('#notes-edit-link').hide();
        $('.edit-invoice-notes').show();
        $('#notes-edit-link').hide();
        $('.display-invoice-notes').hide();
        //Normal string not working for multiline comment for notes. So use `` special character
        var edit_val = `@(Html.Raw(Model.OrderAdditionalDetails?.Notes?.Trim()))`;
        $('.edit-invoice-notes-class').val(edit_val);
    }

    function resetInvoiceNotesControls() {
        $('.display-invoice-notes').show();
        $('.edit-invoice-notes').hide();
        $('#notes-edit-link').show();
        $("#invoiceNotesValidation").text('');
        $('.display-invoice-notes').show();
        $('.edit-invoice-notes-class').val(" ");
    }

    function updateInvoiceNotes() {
        var notes = $("#@Html.IdFor(m => m.OrderAdditionalDetails.Notes)").val();
        if (notes.length <= 0) {
            $("#invoiceNotesValidation").text('Invoice Notes required');
            return;
        }
        else {
            $("#invoiceNotesValidation").text('');
        }
        var data = { Id: @Model.Id, notes: notes };
        var url = "@Url.Action("UpdateInvoiceNotes", "Order",new { area = "Supplier" })";
        $(".invoice-notes-loader").show();
        $.post(url, data, function (response) {
            if (response.StatusCode == @((int)Status.Success)) {
                msgsuccess(response.StatusMessage);
                window.location.reload();
            }
            else {
                msgerror(response.StatusMessage);
            }
        }).always(function () {
            $(".invoice-notes-loader").hide();
        });
	}
	function toggleLocation(element)
	{
		var elemParent = $(element).closest('.my-schedule');
		var location = elemParent.find('.location');
		if ($(element).is(':checked')) {
			location.show();
			if (elemParent.find('.splitload-address').length == 0)
			{
				elemParent.find('#LinkAddLocation').click();
			}
		}
		else {
			location.hide();
		}
	}

	    function updateAddSplitLoadAddressUrl() {
		    $('.link-addlocation').each(function (index, value) {
			    var addSplitLoadAddressUrl = $(this).data('url');
			    $(this).attr('data-url', addSplitLoadAddressUrl + '&countryId=@Model.Country.Id&countryCode=@Model.Country.Code');
		    });
        }

        function SetActivationStatusToActive(element) {
            var parent = $(element).closest('.tank-rental-wrapper');
            parent.find('#ActivationStatusId').val('@((int)ActivationStatus.Active)');
            $('.tank-invoice-link').show();
        }

        function SetActivationStatusToCreate(element) {
            var parent = $(element).closest('.tank-rental-wrapper');
            parent.find('#ActivationStatusId').val('@((int)ActivationStatus.Created)');
        }

        function showTankScheduleSuccessMessage(response) {
            $(this).find('.btn-save').removeAttr('disabled');
            if (response.StatusCode == @((int)Status.Success)) {
                msgsuccess(response.StatusMessage);
                if (response.ActivationStatusId == @((int)ActivationStatus.Active)) {
                    $(this).find('.tankRental-controls').attr('readonly', 'readonly');
                    $(this).find('.tank-schedule-buttons').hide();
                    $(this).find('.link-removetank').hide();
                }
                else if (response.ActivationStatusId == @((int)ActivationStatus.Created)) {
                    $(this).find('.btn-save-activate').removeAttr('disabled');
                    $(this).find('.btn-save-activate').removeAttr('readonly');
                }
                else {
                    $(this).find('.tank-schedule-buttons').removeAttr('readonly');
                }
            }
            else {
                $(this).find('.btn-save').removeAttr('disabled');
                $(this).find('.btn-save').removeAttr('readonly');
                $(this).find('.btn-save-activate').removeAttr('disabled');
                $(this).find('.btn-save-activate').removeAttr('readonly');
                msgerror(response.StatusMessage);
            }
            $(this).find('.btn-save').blur();
            $(this).find('.btn-save-activate').blur();
        }

        function showTankScheduleFailedMessage(response) {
            msgerror(response.StatusMessage);
        }

        function hidePrevScheduleOption(elemt) {
            var freqTypeDdls = $('.tank-rental-wrapper .frequencyTypes:not(:last)');
            var currentDDL = $(elemt).closest('.tankRental-controls').find('select.frequencyTypes:last');
            $.each(freqTypeDdls, function (idx, dropdown) {
                var selected = $(dropdown).val();
                if (selected != null && selected != undefined && selected != '' && !$(dropdown).is(currentDDL)) {
                    var elemtToRemove = currentDDL.find("option[value='" + selected + "']");
                    elemtToRemove.remove();
                }
            });
            showHideAddFreqLink();
        }

        function showHideAddFreqLink() {
            var allFreqTypeDdls = $('.tank-rental-wrapper .frequencyTypes');
            if (allFreqTypeDdls.length >= 4) {
                $('#LinkAddTankSchedule').hide();
            }
        }

        function removeTankSchedule(elem, fuelReqId) {
            var currentDDL = $(elem).closest('.tank-rental-wrapper').find('select.frequencyTypes');
            var freq = parseInt(currentDDL.val());
            var tankfuelRequestId = parseInt(fuelReqId);
            if (tankfuelRequestId > 0) {
                var data = { frequencyId: freq, frId: tankfuelRequestId };
                var url = "@Url.Action("RemoveTankSchedule", "Order",new { area = "Supplier" })";
                $.post(url, data, function (response) {
                    if (response.StatusCode == @((int)Status.Success)) {
                        if ($(".tank-rental-wrapper").length == 0 && $("#IsTankRentalEnabled").is(":checked")) {
                            $("#IsTankRentalEnabled").closest("div").removeClass("pntr-none subSectionOpacity");
                            $("#IsTankRentalEnabled").trigger("click");
                        }
                        msgsuccess(response.StatusMessage);
                    }
                    else {
                        msgerror(response.StatusMessage);
                    }
                }).always(function () {
                });
            }
        }

        function RemovePickUpLocation() {
            var orderId = @Model.Id;
            if (orderId > 0) {
                var removeUrl = '@Url.Action("InActivePickUpLocation", "Order", new { area= "Supplier"})';
                $.post(removeUrl, { orderId: orderId }, function () {
                    msgsuccess("Pick-Up Location removed successfully");
                    $("#div-pick-up-location").html('@Resource.lblHyphen');
                });
            }
            else {
                window.location.reload();
                msgerror("Remove Location Failed");
            }
        }

        function loadPickUpLocation(orderId) {
            var url = '@Url.Action("GetPickUpLocation", "Order", new { area = "Supplier"})';
            $(".pickup-loader").show();
            $.get(url, { orderId: orderId }, function (response) {
                if (response != null || response != "") {
                    $("#pick-up-location").html(response);
                    parseForm();
                }
            }).always(
                function () {
                    $(".pickup-loader").hide();
                }
            );
		}

        function savePickUpLocation() {
            var $form = $("#Modify-pickup-form");
            //var isValidForm = $form.valid();
            var isValidForm = true;
            var submitUrl = $form.attr("action");
            var data = $form.serialize();
            var isFullAddressAvailable = IsAddressAvailableForPickupLocation()
            if (!isFullAddressAvailable) {
                isValidForm = false;
                @*msgerror("@Resource.errMsgAddressMissingForPickup");*@
                msgerror("Required address details are missing for pickup location");
            }
            if (isValidForm) {
                $.post(submitUrl, data, function () {
					$("#add-pickupLocation-modal").modal("hide");
					var bulkplantName = '';
                    var addressValue = '';
                    var cityValue = '';
                    var stateValue = '';
                    var zipValue = '';
					$form.serializeArray().filter(i => {
						if (i.name == "Address.SiteName")
							bulkplantName = i.value;
                        if (i.name == "Address.Address")
                            addressValue = i.value;
                        if (i.name == "Address.City")
                            cityValue = i.value;
                        if (i.name == "Address.State.code")
                            stateValue = i.value;
                        if (i.name == "Address.ZipCode")
                            zipValue = i.value;
                    });
					var address = '<div>' + bulkplantName + '</div><div class="fs12"><i class="fas fa-map-marker fs12 mr5"></i>' + addressValue + ', ' + cityValue + ', ' + stateValue + ' ' + zipValue;
					address += '<a data-toggle="confirmation" data-html="true" data-popout="true" data-singleton="true" data-confirmation-event="RemovePickUpLocation" data-placement="bottom"><i class="fas fa-trash color-maroon fs12 ml5" data-toggle="tooltip" data-placement="top" title="@Resource.btnLabelRemove"></i></a>';
                    //data-toggle="confirmation" data-html="true" data-popout="true" data-singleton="true" data-on-confirm="RemovePickUpLocation" data-placement="bottom"

                    $("#div-pick-up-location").html(address);
                    msgsuccess("Pickup location saved successfully");
                });
            }
        }

        function IsAddressAvailableForPickupLocation() {
            var isValidForm = true;
            var countryId = parseInt($('#Address_Country_Id').val());
            if (countryId != @((int)Country.CAR) ) {
                var zipCode = $('.zipcode.addressInput').val();
                var city = $('.city.addressInput').val();
                var address = $('.address.addressInput').val();
                var countyName = $('.county.addressInput').val();

                if (city === '' || city == undefined || city == null) {
                    isValidForm = false;
                }
                if (address === '' || address == undefined || address == null) {
                    isValidForm = false;
                }
                if (zipCode === '' || zipCode == undefined || zipCode == null) {
                    isValidForm = false;
                }
                if (countyName === '' || countyName == undefined || countyName == null) {
                    isValidForm = false;
                }

            }
            //validate lat-long
            var isGeoCoded = $("#Address_IsGeocodeUsed").is(':checked');
            if (isGeoCoded) {
                var lat = parseFloat($('#Address_Latitude').val());
                var long = parseFloat($('#Address_Longitude').val());
                if (isNaN(lat) || lat == 0) {
                    isValidForm = false;
                    validationMessageFor('Address.Latitude', "@string.Format(Resource.valMessageRequired, Resource.lblLatitude)");
                }
                if (isNaN(long) || long == 0) {
                    isValidForm = false;
                    validationMessageFor('Address.Longitude', "@string.Format(Resource.valMessageRequired, Resource.lblLongitude)");
                }

            }
            else {
                validationMessageFor('Address.Latitude', "");
                validationMessageFor('Address.Longitude', "");
            }
            //validate bulk plant name
            var bulkPlantName = $('#Address_SiteName').val();
            if (bulkPlantName === '' || bulkPlantName == undefined || bulkPlantName == null) {
                isValidForm = false;
                validationMessageFor('Address.SiteName', "@string.Format(Resource.valMessageRequired,"Bulk Plant Name")");
            }
            else { validationMessageFor('Address.SiteName', ""); }

            var stateId = parseInt($('#Address_State_Id').val());
            if (isNaN(stateId) || stateId <= 0) {
                isValidForm = false;
                validationMessageFor('Address.State.Id', "@string.Format(Resource.valMessageRequired,"State")");

            }
            else { validationMessageFor('Address.State.Id', ""); }



        return isValidForm;
    }

        function validateScheduleQuantityType(ele) {
            var selectedType = $(ele).val();
            var container = $(ele).closest('.schedule-type-container').find('.schedule-qty-container');
            if (selectedType == '@((int)ScheduleQuantityType.Quantity)')
                container.removeClass('hide-element');
            else
                container.addClass('hide-element');

            return false;
        }
        function EnableDisableSaveButton() {
            var container = $('#delivery-schedule-section').find('.partial-block-collection-section').find(".partial-block");
            if (container && container.length > 0) {
                $('.btnSubmitSchedule').removeAttr("disabled");
            }
            else {
                if ($("#SaveButtonEnable").length > 0) {

                } else {
                    $(".btnSubmitSchedule").attr("disabled", true);
                }

            }
        }

        function GetAssignedProductName(selectedTerminal) {
            var inputData = {
                terminalId: selectedTerminal,
                orderId: '@Model.Id'
            };
            $.ajax({
                url: "/Supplier/Order/GetAssignedProductName/",
                type: "POST",
                dataType: "text",
                data: inputData,
                success: function (response) {
                    if (response != null) {
                        var obj = JSON.parse(response);
                        if (obj.MyProductId === undefined || obj.MyProductId === null || obj.MyProductId === "") {
                            $('#assignedProductName').html('--');
                        }
                        else {
                            $('#assignedProductName').html(obj.MyProductId);
                        }

                        if (obj.DriverProductId === undefined || obj.DriverProductId === null || obj.DriverProductId === "") {
                            $('#driverProductId').html('--');
                        }
                        else {
                            $('#driverProductId').html(obj.MyProductId);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    }
            });
        }
        function editOrderName(element, displaySection, actionButtons) {
            $(element).hide();
            $("." + displaySection).find("input").attr("disabled", false);
            $("." + actionButtons).show();

        }
        function cancelEditOrderName(editButton, displaySection, actionButtons) {
            var prevOrderName = $('#hdnOrderName').val();
            $("#@Html.IdFor(m => m.OrderName)").val(prevOrderName);
            $("#" + editButton).show();
            $("." + displaySection).find("input").attr("disabled", true);
            $("." + actionButtons).hide();
        }

          function updateOrderName() {
            var orderName = $('#@Html.IdFor(m => m.OrderName)').val();
            var data = {
                id: @Model.Id,
                orderName: orderName
            }
            var targetUrl = '@Url.Action("UpdateOrderName", "Order", new { area = "Supplier" })';
            $.post(targetUrl, data, function (response) {
                if (response.StatusCode == 0) {
                    $('#hdnOrderName').val($("#@Html.IdFor(m => m.OrderName)").val());
                    cancelEditOrderName('edit-orderName-icon', 'orderName-details', 'orderName-buttons')
                    msgsuccess(response.StatusMessage);                }
            }).always(function () { $(".orderName-details").find('.loading-wrapper').hide(); });
        }
         $(document).off('savePoNumber');
         $(document).on('savePoNumber', function (e) {
             savePoNumber();
         });
         $(document).off('RemovePickUpLocation');
        $(document).on('RemovePickUpLocation', function (e) {
             RemovePickUpLocation();
        });
        $(document).off('saveDriver');
        $(document).on('saveDriver', function (e) {
             saveDriver();
        });
         $(document).off('updateInvoiceNotes');
        $(document).on('updateInvoiceNotes', function (e) {
             updateInvoiceNotes();
        });
        // $(document).on('updateInvoiceNotes', function (e) {
        //     updateInvoiceNotes();
        //});

        @*$( document ).ready(function() {
            if (@Model.IsTankRentalEnabled) {
                $(".tankFrequency-controls").toggleClass("hide-element");
            }
        });*@

        function closeGlobalFuelCostPopup() {
            var oldFuelCost = parseFloat($('#GlobalFuelCost').val());
            var newFuelCost = parseFloat($('.current-cost').val());
            if ((!isNaN(oldFuelCost) && !isNaN(newFuelCost)) && oldFuelCost != newFuelCost) {
                //location.reload();
                $('#GlobalFuelCost').val(newFuelCost);
            }
        }
        function editIsDispatchRetained() {
           $("#hdnIsDispatchRetained").val($('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').prop('checked'));
           $('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').attr("disabled", false);
            $(".isRetained-buttons").show();
        }
        function cancelEditIsDispatchRetained() {
            var isCheck = false;
            if ($("#hdnIsDispatchRetained").val() == "true") {
                isCheck = true;
            }
            $('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').val(isCheck);
            $('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').prop('checked', isCheck)
            $(".isRetained-buttons").hide();
            $('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').attr("disabled", true);
        }
        function updateIsDispatchRetained() {
            var isDispatchRetained = $('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').prop('checked');
            var targetUrl = '@Url.Action("UpdateIsDispatchRetainedForBrokerOrders", "Order", new { area = "Supplier" })';
            $(".dispatchRetained-loader").show();
            $.get(targetUrl, { 'OrderId': @Model.Id, 'IsDispatchRetained': isDispatchRetained}, function (response) {
                if (response.StatusCode == 0) {
                    $("#hdnIsDispatchRetained").val($('#@Html.IdFor(m => m.FuelDeliveryDetails.IsDispatchRetainedByCustomer)').prop('checked'));
                    cancelEditIsDispatchRetained();
                    msgsuccess(response.StatusMessage);                }
            }).always(function () { $(".dispatchRetained-details").find('.loading-wrapper').hide(); });
    }

    function postBadgeDetails() {
        var isValidBadgeDtls = true
        var allElements = $('.terminal-bulkplant-section .partial-block');
        $.each(allElements, function (i, element) {
            var terminal = $(element).find('.selectTerminal');
            var bulkplant = $(element).find('.selectBulkPlant');
            var badge1 = $(element).find('.badge1');
            var badge2 = $(element).find('.badge2');
            var badge3 = $(element).find('.badge3');

            validationMessageFor(terminal.attr('name'), '');
            validationMessageFor(bulkplant.attr('name'), '');
            validationMessageFor(badge1.attr('name'), '');

            if ($(element).find(".radio-badge-terminal").is(':checked')) {
                if (terminal.val() == 'undefined' || terminal.val() == null || terminal.val() == "") {
                    validationMessageFor(terminal.attr('name'), 'Please select Terminal');
                    isValidBadgeDtls = false;
                    return false;
                }
            }
            else if ($(element).find(".radio-badge-bulkplant").is(':checked')) {
                if (bulkplant.val() == 'undefined' || bulkplant.val() == null || bulkplant.val() == "") {
                    validationMessageFor(bulkplant.attr('name'), 'Please select Bulk Plant');
                    isValidBadgeDtls = false;
                    return false;
                }
            }

            if (badge1.val() == "" && badge2.val() == "" && badge3.val() == "") {
                validationMessageFor(badge1.attr('name'), 'Please enter Badge #');
                isValidBadgeDtls = false;
                return false;
            }
        });

        if (isValidBadgeDtls) {
            $('#update-badge-details-form').submit();
            return true;
        }
    }

        function validateTerminalsAndBulkPlantsForRegions() {
        var isValid = true;
        // also need to remove existing validation messages from controls
        var sourceRegions = $('#@Html.IdFor(m=>m.SourceRegion.SelectedSourceRegions) option:selected')
                           .toArray().map(item => parseInt(item.value));
        if (sourceRegions.length == 0) {
             validationMessageFor($("#@Html.IdFor(m => m.SourceRegion.SelectedSourceRegions)").attr('name'), 'Source region is required');
                isValid = false;
        }
        var terminals = $('#@Html.IdFor(m => m.SourceRegion.SelectedTerminals) option:selected')
                .toArray().map(item => parseInt(item.value));

         var bulkplants = $('#@Html.IdFor(m => m.SourceRegion.SelectedBulkPlants) option:selected')
                .toArray().map(item => parseInt(item.value));

         if (terminals.length == 0 && bulkplants.length == 0) {
                validationMessageFor($("#@Html.IdFor(m => m.SourceRegion.SelectedTerminals)").attr('name'), '@Resource.errorMessageSelectTerminalOrBulkplant');
                //msgerror('@Resource.errorMessageSelectTerminalOrBulkplant');
                isValid = false;
            }

         return isValid;
        }

    function updateFreightRateAndFuelSurchargeForAuto(ele) {
            var isFreightCost = $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFreightCost)"]:checked').val();
            var isFuelSurcharge =  $('input[name="@Html.NameFor(m => m.OrderAdditionalDetails.IsFuelSurchargeAuto)"]:checked').val();

            var selectedFreightRateRuleId = $("#@Html.IdFor(m => m.OrderAdditionalDetails.FreightRateRuleId)").val();
            var flag = true;
            if (isFreightCost && selectedFreightRateRuleId == '') {
                $("#@Html.IdFor(m => m.OrderAdditionalDetails.FreightRateRuleId)").val(null);
                validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.FreightRateRuleId)", '@Resource.lblRequired');
                selectedFreightRateRuleId = null;
                flag = false;
            };

            var selectedFuelSurchargeTableId = $("#@Html.IdFor(m => m.OrderAdditionalDetails.FuelSurchargeTableId)").val();
            if (isFuelSurcharge && selectedFuelSurchargeTableId == '') {
                $("#@Html.IdFor(m => m.OrderAdditionalDetails.FuelSurchargeTableId)").val(null);
                validationMessageFor("@Html.NameFor(m => m.OrderAdditionalDetails.FuelSurchargeTableId)", '@Resource.lblRequired');
                selectedFuelSurchargeTableId = null;
                flag = false;
            };
            if (!flag) {
                return
            };

            $(ele).prop('disabled', true); //disable save button
            var selectedFreightRateRuleType = $("#@Html.IdFor(m => m.OrderAdditionalDetails.FreightRateRuleType)").val();
            var selectedTableType = $("#@Html.IdFor(m => m.OrderAdditionalDetails.FreightRateTableType)").val();

            if (selectedFreightRateRuleType == '@((int)FreightRateRuleType.P2P)') {
                selectedTableType = '@((int)TableTypes.CustomerSpecific)';
            }

            var selectedfsTableType = $("#@Html.IdFor(m => m.OrderAdditionalDetails.FuelSurchargeTableType)").val();
            var target = $("#@Html.IdFor(m => m.OrderAdditionalDetails.FreightRateRuleId)");

            var url = '@Url.Action("UpdateFreightRateAndFuelSurchargeForAuto", "Order", new { area = "Supplier" })';
            var model = {
                'OrderAdditionalDetails.FreightRateRuleType': selectedFreightRateRuleType,
                'OrderAdditionalDetails.FreightRateTableType': selectedTableType,
                'OrderAdditionalDetails.FreightRateRuleId': selectedFreightRateRuleId,
                'OrderAdditionalDetails.IsFreightCost': isFreightCost,
                'OrderAdditionalDetails.IsFuelSurcharge': isFuelSurcharge,
                'OrderAdditionalDetails.FuelSurchargeTableType': selectedfsTableType,
                'OrderAdditionalDetails.FuelSurchargeTableId': selectedFuelSurchargeTableId,
                'Id': '@Model.Id'
            }
            $.post(url, model,
                function (response) {
                    $(ele).prop('disabled', false);
                     validationMessageFor($("#@Html.IdFor(m=> m.OrderAdditionalDetails.FreightRateRuleId)").attr('name'), '');
                     validationMessageFor($("#@Html.IdFor(m=> m.OrderAdditionalDetails.FuelSurchargeTableId)").attr('name'), '');

                    cancelEditSourceRegion('edit-freight-cost-details', 'freight-cost-details', 'freight-cost-actionbuttons');

                    if (response.StatusCode == 0) {
                        msgsuccess(response.StatusMessage);
                    }
                    else if (response.StatusCode == 1) {
                        msgerror(response.StatusMessage);
                    }
                });
        }

       

    function showUpdateAccessorialSuccessMessage(response) {
        cancelAccessorialFeesRegion('edit-Accessorial-Fees-details', 'Accessorial-Fees-details', 'Accessorial-Fees-actionbuttons', 'Edit-Accessorial-Fees', 'View-Accessorial-Fees');
        if (response.StatusCode == 0) {
            msgsuccess(response.StatusMessage);
        }
        else {
            msgerror(response.StatusMessage);
        }
    }

    function showUpdateAccessorialFailedMessage(response) {
        cancelAccessorialFeesRegion('edit-Accessorial-Fees-details', 'Accessorial-Fees-details', 'Accessorial-Fees-actionbuttons', 'Edit-Accessorial-Fees', 'View-Accessorial-Fees');
        msgerror(response.StatusMessage);
    }

        function updateSourceRegion(ele) {
            if (validateTerminalsAndBulkPlantsForRegions()) {
              $(ele).prop('disabled', true); //disable save button
              var sourceRegions = $('#@Html.IdFor(m=>m.SourceRegion.SelectedSourceRegions) option:selected')
                                  .toArray().map(item => parseInt(item.value));
              var terminals = $('#@Html.IdFor(m => m.SourceRegion.SelectedTerminals) option:selected')
                                .toArray().map(item => parseInt(item.value));
              var bulkplants = $('#@Html.IdFor(m => m.SourceRegion.SelectedBulkPlants) option:selected')
                                .toArray().map(item => parseInt(item.value));
              var approvedTerminalId = parseInt($('#@Html.IdFor(m=>m.SourceRegion.ApprovedTerminalId)').val());
              var approvedBulkPlantId = parseInt($('#@Html.IdFor(m=>m.SourceRegion.ApprovedBulkPlantId)').val());
              var orderId = parseInt($('#@Html.IdFor(m=>m.Id)').val());
              var freightPricingMethod = $('input[name="@Html.NameFor(m => m.SourceRegion.FreightPricingMethod)"]:checked').val();
              var fuelTypeId = parseInt($('#@Html.IdFor(m=>m.SourceRegion.FuelTypeId)').val());

                var inputModel = {
                    SelectedSourceRegions :sourceRegions,
                    SelectedTerminals: terminals,
                    SelectedBulkPlants: bulkplants,
                    ApprovedTerminalId: approvedTerminalId,
                    OrderId: orderId,
                    FuelTypeId: fuelTypeId,
                    ApprovedBulkPlantId: approvedBulkPlantId,
                    FreightPricingMethod : freightPricingMethod
                };
                 var url = '@Url.Action("UpdateSourceRegionDetails", "Order", new { area = "Supplier" })';
                $.post(url, inputModel).done(function (response) {
                    if (response != null) {
                        cancelEditSourceRegion('edit-source-region-details', 'source-region-details', 'source-region-actionbuttons')
                        if (response.StatusCode == 0) {
                            msgsuccess(response.StatusMessage);
                        }
                        else  {
                            msgerror(response.StatusMessage);
                        }
                    }
                 });

            }
            else {
               // alert("Form is invalid");
            }
    }
</script>
}
<style>
    span.select2-dropdown {
        z-index: 2055;
    }
</style>